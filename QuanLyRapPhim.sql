CREATE DATABASE QuanLyRapPhim
GO

USE QuanLyRapPhim
GO

CREATE TABLE PhanLoai
(
	MaPL NVARCHAR(10) CONSTRAINT PK_PL_MaPL PRIMARY KEY(MaPL),
	TenPL NVARCHAR(50),
	MoTa NVARCHAR(100),
	BieuTuongPL IMAGE
)
GO

INSERT [dbo].[PhanLoai] ([MaPL], [MoTa], [BieuTuongPL]) VALUES (N'K', N'K - Dưới 13 tuổi xem cùng cha mẹ', N'Phim được phổ biến đến người xem dưới 13 tuổi với điều kiện xem cùng cha, mẹ hoặc người giám hộ', 0x89504E470D0A1A0A0000000D49484452000000370000001B0803000000EF6BE739000000206348524D00007A26000080840000FA00000080E8000075300000EA6000003A98000017709CBA513C00000279504C5445FF9999FF8BB7EF9BA6F197ACFF9CA2FFA7ABFF837EF8A4B4EB899EF097A7FF97BEFF85A9F097AAEF8FA4F091A1F098A8EF93AAEE7B99ED92A4EE98AFFC9E9EFCA8B7EB7997F099A7F990ACFE9291CA8B8BFC86B4EF99A5F196AAFF9CA6FF8085F398ABF295A7F294A7F294A6F293A6F294A7F295A8F399ABF296A9F192A5F192A6F296A9F39BACF194A7F191A5F294A7F39BADF296A8F296A8F194A7F191A4F191A4F194A7F297A9F296A8F193A6F193A5F192A5F193A6F194A7F193A6F293A6F292A5F293A6F192A5F193A6F192A5F193A5F194A7F297A9F296A8F194A6F191A4F191A4F294A7F295A7F297A9F39BACF294A6F294A6F397AAF296A8F192A5F192A5F296A8F296AAF194A7F193A6F192A5F194A7F398AAF296A8F39CADF39CAEF39DAEF295A7F192A5F7C0CBFADEE4FADAE0F6B8C4F4A7B6FBDFE4F5B3C0F3A3B3F3A4B3F6BAC7FADCE2F3A0B0F4A5B5FADBE1F7C3CEF193A6F292A5F8CBD4F9D4DCF297A9F6BEC9F7C5CFF293A6F29AACF8CCD4FADDE3F4A2B2FBE2E7F294A7F295A8F6BBC7FADFE5F29BADF4A3B3FADAE1F5B4C1F9D1D9F8C6D0F4A6B6F8CCD5F8C9D2F3A1B1F292A4F4A4B4F29CADF39EAFFEFFFFFCEDF0FBE3E8FEF8F9F7C4CEF4A5B4F191A4F39FB0FADEE3FFFFFEFEF9FAF7C6D0FAD8DFFEFEFEFEFAFBF296A9FCECEFFEFDFDFEFBFBF297AAFDF1F3FEFBFCFDF0F3F4A6B5FEFDFEFEFCFCF9D3DBFDF5F7F5B2BFF9D2DAF299ABF4AAB9FDF1F4FCEFF2F291A4F8CAD3F294A6F3A1B2FCE9ECFDF3F5F5AEBCF191A5F6BDC8FBE0E5F7C3CDFCEFF1FADFE4F9D6DDFCEBEEFBE0E6F4ACBBF194A6F29AABF29BACF6B5C2F298AAF6BCC8F292A6FBDEE4F7BFCAF4ABBAF7BDC8F5ACBBF3A4B4FBE1E6FFFFFFDA5AD13A0000005D74524E5300000000000000000000000000000000000000000000000000000000000000003EDBECEBEBEDCF2860F6ED4720B9FEA4132E50B2FAF6A3482AD8F0FEEEC9F5E6F4E5F4E4F8F6D54266C2FCF9B45E3D2AC4B01D67F7EF4E42E4F6F5D82B9B1B3A5700000001624B4744D2E0D8AEB0000000097048597300000EC400000EC401952B0E1B0000000774494D4507E803070D32138DA2F7DA000002B27A5458745261772070726F66696C65207479706520786D70000048C7955649B69C300CDCEB1439822DD9121C87C1ECF25E96397E4A66F8345393E6B5993494CA2A1BFAFBFB0FFDC22F725292C11AE9ACD1D1828E9A2D69E4E0F73A6831F17732B269D4A493B266E9E6E79BF5C4268542C7E1F3406886934A9739A5A487B0F33B0FDD58C211A443A889ACFEB818ACB8E80443E349A2B47EE02A0863648CE31C0467B1166181C61A1E3D010B39ACD03DE102A86CA282FBD602DC5B94588073798FA2598108753A50B673B07D4970927341089C1170E0426B316E8831C3313B8D0E1D905124175908BDC25D1374960870933B5F9B6DE5451D80FCC186007AD0762DA3DE452D6A5E46A5120CA982D6ECA11C574EDA685B62DFF5139E04EDFD9AFA0997A2CDA07DF00E5219A417044E88DA39A93C226F9481A78D5EA43EA2A319DE8FD153113393CEC89910FA347C9EF2A746A1F79DF2DC28F4D32929D60E4130E573C7D4FE2DBAB3F1C04BCAA2823ED2116690E4D635E1BE6B3E92399FF09A2DE9AE73B2A0DCF8DC5D4BE3AC7D84E523A27038E664E0087381C23257DEA62A01BCFB869116904E7476063062F22167A85E128F384B1DCD67F550DACE8B34BD62231BA84F6D4D220267C12202A4B8F6344E3616185C22B83F8624A264DC411C8237589312EE1BE0C9D52D613823431A5AF3BC4085C00BA68CB2FDAF185BC8274924E46A6BCE70916973FD9E86A065CC8CCB769B33A7FA14F4CA6E1F9ECE3ABBD2F6D1E6DC65B437BBEFDBFB90AB4EE9BDBE9FE54DEFF5BDDBDBC2796FA3BDB2D7BDD4D53C8B797659C42CF762B640EBBA581785C6F7142969C42ADCF710646A7C3DEE46CB959770653D07A66F24BEE590FE67377DE2903EBF3BFC9BE47E75BCE0B081F6837348CF2BE2127ABF60A078EF721C03D814DF050DFB1E555EBE98BF6949BAA2F3E8F6452EF52B8A6EF39DBEE3F055F60FDA57402C87E69B3B000001DA4944415438CB636060645250545256211628ABAAA933B3B032B0B1736868C6C6C5130912E212B5B439B9B8197878757493925352890529697AFA067CFC0C8646C626E9199959D9C481AC9CDC3C5333730B064BABA4FC82C2A26262416C49699EB58D2D835D59794645597125B120A9AABA262DD19EC1A1B62EB31E9736A0783D86C686C6A6664706A796D6040C6DC56DED1D55C595C59D5DEDDD3DE8B2BD7D05FD207D051330F5754D9C94575C9C3579E294A9B1E892BDD35A71EAAB06EA9B3E63E6ACD973628B49D437A379EEBCF9DD0B30BD8E5FDFC2F4F6458B4B96600931FCFA96A62E9BB87CC5F44A52F52D5AB972D1A2AE4492F54D5CB53A77E29AB549A4EA5BB56EFD868D13274F20355C36656DAEDFB26851F75612F54D9A515CBC6DFBC41D3B7791A20F9C5E2A9376CF9FB827BE18873E6CE973EFBEFD40D38AAB0EEC3B98861E34BD7DA9407D0EB5870E27A16B4C5A9F977004441FCDCB3B56846666E5F1FD407D76272A524E26A26B3C550C1101E554346D27A69E3E13EBC8E0EC5274F6F4B924A2F37B7D456A7E92AB1B83BB87A7D7F98CC3F109C481B8B6940BDE3EBE7E0C0282FE0145732EB6120BEA76EF0A0C1212661011150B0E59DFD2472C68290B0D13979064909296098F888C221E4446C7C8CAC90300948894B67CD518E20000003B74455874436F6D6D656E740078723A643A4441462D315A55344C454D3A332C6A3A333038333133343837363834363432333539372C743A3234303330373133E437CC6B0000002574455874646174653A63726561746500323032342D30332D30375431333A35303A30352B30303A30300D3885730000002574455874646174653A6D6F6469667900323032342D30332D30375431333A35303A30352B30303A30307C653DCF0000002874455874646174653A74696D657374616D7000323032342D30332D30375431333A35303A31392B30303A3030207A76FA00000015744558747064663A417574686F72004DE1BBB92048E1BAAD75C519F9840000001574455874786D703A43726561746F72546F6F6C0043616E7661EAC712B10000000049454E44AE426082)
INSERT [dbo].[PhanLoai] ([MaPL], [MoTa], [BieuTuongPL]) VALUES (N'P', N'P - Mọi độ tuổi', N'Phim được phép phổ biến đến người xem ở mọi độ tuổi', 0x89504E470D0A1A0A0000000D49484452000000370000001B0803000000EF6BE739000000206348524D00007A26000080840000FA00000080E8000075300000EA6000003A98000017709CBA513C0000029A504C544599CC5A80B6389DCF5A97C858A5A84F79C23EA5D5568FC74A9ACD589ABC3B9ECA548DB94E93CE5297CE5393C94E8AC33697CB52A1BB5EB3DB7995CB5095CC52467279BFBF7F82BA409ED05D9BCB5EA6AB4D99CA5594C94E93C94C92C84A92C84B93C94C95CA50A2C26598CA5393C84C93C94E98CE5B9CCD5B94C94F92C84B97CA53A6CD6793C94E94CB4F94C94E91C84992C84B95C95095C84F93C94D92C84B92C84B92C84C93C84C91C84A91C84992C84993C84C94C94E93C94C91C84A92C84B93C94D98CB5597CB5395CA5092C84B93C94D96CA5297CA53A1CE6295C95092C84B96CA5298CB5493C94D94C94E92CD569ACC5995CA5094C94D93C94D94C94D94C94E96CA52ADC97697CB53A6D26CA8D36FA1D06493C94D91C84AB9DC8CE3F1D1D9EBC0D9EBC1DCEDC5DDEEC8A0CF62A3D066B5D98599CC569ACC579CCD5BD0E7B1CAE4A795CA50A7D36EDAECC2C8E3A492C94B93C94B92C84AA2D066C6E2A19BCC5995CA4FC0DF97DFEFCBC3E19C98CB5593C94C92C84BA5D16AD5E9B9AAD47398CC55DBEDC3B7DB8992C84C96CA5298CB54D4E9B898CC56D8EBBFABD47491C84996CA51CAE4A8E1F0CEE0EFCDE1EFCDE0EFCBDCEDC6CBE5A9A6D26BC9E4A6ABD575DFEFCAFFFFFFFEFEFFFCFDFCFDFEFDFEFEFEE7F3D9A7D26EDEEFC9EAF4DCBBDD8EB8DB8ABDDD91FBFDF9FFFEFFD0E7B294C94EDEEEC991C8489ECE5EE7F2D7E3F1D299CC5796CA50E2F0D0E4F1D39ACC58E5F2D4ADD677F7FBF2D3E9B894C94FF5FAEFF5F9EEFEFEFDEEF6E3ACD576FAFCF7F1F7E8F0F7E7EFF7E5EAF4DDD7EBBDADD678A2D166A2D0659DCE5DDEEECA97CB52E2F0CFC5E2A097CB5493C84BDDEEC7BEDE93AED679D6EABBD5EABAB5DA85C8E3A39FCF61E0EFCCB2D88093C84DD6EABCA9D371A9D370DBECC3BCDD91DBEDC4DAECC399CC58391717770000005874524E5300000000000000000000000000000000000000000000000000000022D2FCFAFAFB8B0345EBB4111FADF069074569BBFAE9945AD3F9FEF5DEFEFEFEDFBCE5FBF4DD20378AEECF5E2B0A8BE24534E3A5091DBAE1DFDFE07902402D3D7F00000001624B474497E66E1BAF000000097048597300000EC400000EC401952B0E1B0000000774494D4507E803070D32138DA2F7DA000002B17A5458745261772070726F66696C65207479706520786D70000048C7955649B69C300CDCEB143982916CC91C87C1ECF25E96397E4A66F8345393E6B5993494CA2A1BFAFBFB0FFDC2AFE1A8248365E92CEB6841474D16B5E1E0F73A6831F17732B269A35127654DD2CDCF37EB894D0A858EC3E781D00C27952E718C510F61E7771E3A5BC411A443A889ACFEB818ACB8E80443E3491A69FDC05510C6C818C73908CE622DC2028D651E3D010B39ACD03DE102A864A282FBD602DC5B94588073798FA2598108753A50B673B07D4970927341089C1070E0426B316E8831C131398D0E1D905124175908BDC25D1374160970A33B5F9B6DE5353A00F9830D01F4A0ED5A46BD6BB4A87919954A30A40A5A9387725C296AD6B6347DD74F7812B4F76BEA275C8AE641FBE01DA432482F081C11B5735279445E9681A78D5EA43EA2A319DE8FD153113393CEC89910FA347C9EF2A746A1F79DF2DC28F4D329B1A91D8260CAE78EA9FD5B7467E381979445057DA423CC20C9AD6BC27DD77C24733EE1355BD25DE72441B9CD73772D8DB3F611968F0685C331450347980B1496B8F2365509E0DD378CB48074A293338011938FBEF1DE893CE22C75349FD543693B2FD2F88A8D64A03EB6358962F484408A6BA4410D98B5240919A364FCB1E6E0EC59FC35BB3424D5B5298BFF0C4FF80219D2D09AE7052A0459302594ED7FC5D822519486507B8BDB2CE122D3E6FA3D0D41CB981997ED3667452EE05FD9EDC3D3596757DA3EDA9CBB8CF666F77D7B1F72D529BDD7F7B3BCE9BDBE777B5B38EF6DB457F6BA97BA9A6731CF2E8B98E55ECC16685D17EBA2907D4F911247ACC27D0F41C6ECEB71375AAABC842BEB39307D23F12D87F43FBBE91387F4F9DDE1DF24F7ABE3058719DA0FCE213DAF884BE8FD8281E2BDCB710C60537C178496A1B5A1C67D347FD3927445E7D1ED8B5CEA5714DDE63B7DC7E1ABEC1F2A2E403C8D35A206000001BD4944415438CB6360606492969195231EC82B282A31B330B0B2B12BAB444446110DA26354D5383819B8B8D53562E3E2131289030949C9299A5ADA3C0C3ABA7AFAA9C969E9194482CCACEC1C03432306639398DCBCFC9C8242224151715249A9A9198379597945655541353A002BAAC6026A6AEBF2EA2D18CC1B1A9B9A31B5B55401416B4B7511A6C6A2AAB6724B06F3F68ECE2E0CB9EE9EDEBEFEBE0913274DAEC1A2714AB91548DFD4580C47464C9B3E63E6CC59D367CF998B69634D366E7DF3A6CF5FB07051DEE2254B9791A86F794ED78A95ABA6AF5E5348A2BEB55D5D55EBA6AFDF40A2BE8D9DB99BB2374FDFB29544772EDEB67DF38EE93B77911A2EBBF7ECDDB7FFC041CC6820A06F75E4A1C347BA8B48D677B4BBA8A8A0BA9A647DD38E614D9E04F4554C9F40505F3D96F4997D7CCA5A1CDA0A63C1E9B335EFC41A4CDF779FECC6A1ADFA54EDE933960CD63167CF9D8FC6D488CB91D53117965FBC54C460636BB766D2B90D5D45448215672F5FB96AEFC0E0E8E4ECB2E65A49D475E2C08D5D376FD5B8BAB933F0F27978DA1DBC9D402CB8B374839737BF0083A090B08F6F4CFA5DA24144B39FBF88288398B84440605030F12024342C5C520A001220AEB7BF3D36E60000003B74455874436F6D6D656E740078723A643A4441462D315A55344C454D3A332C6A3A333038333133343837363834363432333539372C743A3234303330373133E437CC6B0000002574455874646174653A63726561746500323032342D30332D30375431333A35303A30352B30303A30300D3885730000002574455874646174653A6D6F6469667900323032342D30332D30375431333A35303A30352B30303A30307C653DCF0000002874455874646174653A74696D657374616D7000323032342D30332D30375431333A35303A31392B30303A3030207A76FA00000015744558747064663A417574686F72004DE1BBB92048E1BAAD75C519F9840000001574455874786D703A43726561746F72546F6F6C0043616E7661EAC712B10000000049454E44AE426082)
INSERT [dbo].[PhanLoai] ([MaPL], [MoTa], [BieuTuongPL]) VALUES (N'T13', N'T13 - Từ đủ 13 tuổi', N'Phim được phổ biến đến người xem từ đủ 13 tuổi trở lên', 0x89504E470D0A1A0A0000000D49484452000000370000001B0803000000EF6BE739000000206348524D00007A26000080840000FA00000080E8000075300000EA6000003A98000017709CBA513C000002CD504C544566CCCC73B4FF74B6DE77BADE63A4FEA5ACFF63BEFF8DBDE966ADE16DADDB82CCF949A4FF71B4E169B1E468B0DF75B6E076B4E258A3E262A8DB76B4E35CB7E390CBEF5DAAE06FACDA7BC2F15FB7E45E9CB977B4FE71B5DE76B8DE5FAAFF7FF9FF75B7E46FB4E36EB3E36DB3E36EB3E36FB4E375B6E571B5E36CB2E26DB3E271B6E478B9E46FB4E26FB4E37AB8E670B5E371B5E36FB3E26BB1E26BB1E26FB3E272B5E371B5E46EB3E26DB2E26CB2E26DB2E26FB3E36DB3E36CB2E26DB3E26EB3E26DB2E26CB2E26EB4E372B5E371B5E36FB3E26AB1E26BB1E26FB3E371B5E372B6E477B8E46EB3E26EB3E376B9E671B5E36CB2E26DB2E270B5E473B6E46DB2E26DB3E26EB4E373B6E470B4E379B9E579BAE56CB2E2A6D0EDD3E8F6CDE5F5A3CFED85BFE7D2E8F69CCBEB82BEE683BEE79FCDECD2E7F682BDE683BEE6CBE4F5B2D7F06EB3E36BB2E26CB2E3B6D9F0C9E3F481BDE672B5E3A4CFEDB4D8F075B7E46DB3E3B6D9F1A2CEEC71B4E37EBBE6D7EAF76FB4E36CB3E36DB3E26EB4E3D6E9F77BBAE57FBCE6CEE5F584BEE7BBDBF2C0DEF2C1DEF3A5D0ED6BB2E380BDE6BEDDF2BADBF18FC5E9B7D9F1C3E0F3B9DAF192C6EA7CBAE595C7EAF7FBFDFFFFFFFFFFFED0E6F571B5E373B6E4FEFEFEECF5FBA1CEECEEF6FBFDFEFEEFF7FBA7D1ED82BEE7DBECF7F4F9FCC1DFF2B7DAF19ECCECC1DEF2F8FBFDEBF4FAE4F0F9D0E6F6A7D1EED1E7F6E8F3FAB5D8F0E9F4FA96C8EAE2EFF9FCFDFEFFFEFE68B0E291C5E9F9FBFD97C9EBCAE3F478B9E56FB3E3A9D2EEFAFCFD87C0E774B6E4F2F8FCABD3EE6AB1E2A8D2EE98C9EB8CC3E8AAD2EEF1F8FCF5F9FD72B5E4B3D7F0AFD5EFD8EAF799C9EBF6FAFDA5CFED76B7E4EAF4FAB6D8F177B8E4DDEDF8EDF5FBE7F2FAE9F3FAD6EAF77EBCE6C3DFF3EBF4FBF3F9FC91C6E9D5E9F694C7EA84BFE78EC4E988C1E797C8EA73B6E3AED4EF8BC2E8ADD4EFCFE6F589C1E86DB2E2D4E8F693C6EA7AB9E5D4E9F688C1E881DD6CD30000005874524E53000000000000000000000000000000000000000000000000000000000000000036D7ECEBEDD43058F4F1501BB3AB172D4DADF9F7A84A2CD4F0FEEFCFECF0EBE0F7F7DA4163BEFBFAB9613F25BEB7215EF5F2573AF6F6DD33B819F21D00000001624B4744947F674A15000000097048597300000EC400000EC401952B0E1B0000000774494D4507E803070D32138DA2F7DA000002B67A5458745261772070726F66696C65207479706520786D70000048C7955649B6DC200CDCEB1439024820E1E378C0BBBC97658E9F12B6FBBBDB433BEDD7784063A112D0DFDF7FE8177E9193928C56A4B7A293059D345BD2C8C1DF75D46AE27332B169D4A4B3B266E997EF2FE9994D2A859EC3FB05D30C25953E734A493FCC2E736EBA58C215A487A999ACFDB81AA4B8EA0C41E359A2747EE1290863648CD3620477B10E66118D159EDC010B7958A1BF8B0B41651315BC7716A0DE21C58A38D77924CD8A8890A707CA7634B64F094A724C0886330C8E5C694BC6053166286687D14347C84892ABAC809EC5DD1CF49608E126573E177BA5177544E4373284A047EDB634DA5BD4AAE669342881902A60CD6ECAE3CA498B76350EFD30E34BD0C19F6998F1285A461D825790CA2883C07082D5DE41E5097EB38C3CBFE085EBCFE86809EF47E82E89054947E40808BD0BDE2FF95DA1D0F34AB92F14FAA994145B85C098F2B1625AFD56DDC9B8E1D56555411DE9043150F25535E1BA6ADE9C399ED05A24E9AA72B220DD785F5D6BE16C7584F61191381473326084B54062991B6E73A300E6BEC5486B900E7476043062F14167B05E124FB84B1BCD57F523B59D16697A844636409FBAE6A493842BE3AF78467B9188D4340A3A8C4F2125448077F66E846F055F5CD58047079A881411CC1D23831BDAFC3C880A3D6D8D29C399FF156307D3492221F70EAF45C289A797EA7737042E63659CB6AF3573A80F46CFE4F6E6E9C8B3336E7FCA1CAB8CF662D7757B6D72E3293DE7F73DBDE939BF777B5B38EE6DB467F6B6973A9B17322F2A2B99E59ACC1668EB8BAD2914DF53A4A6095D781840C854BC1FF7932DAD369C492F86E91B884F31A4FFD94DEF30A4F773879F49AEBBE3098605DC0F8E21DD77C4D5F4BE612079AF725C23D014DF05C16A706D6C766FC59F94249DC1F9A9F6852EED144597FE0EE7389CCAFE012BC8403BA5A5FB430000027A4944415438CB6360606452505452261EA8A8AA31B3B032B0B173A86B444446110B222334B538B9B8197878B575A26362E38805B1F1D1BA7A7CFC0CFA068646098949C929C481E4D4B4746313533306730BCB8CCCACEC9C5CE2404E445E7E81A59535836661516C71496E29B120BAA42CADBCC286C1B6B22AA91AA62D1B06C0BC9AECEA5A109D535B571A8DD0589D5ADFA0CC60DBD85409D596DBDCD20A016DEDD5A5A51D9D5DDD9140A9EA9EDEBEFE09D535308D1D054D13C1FA1AA1FA3A264D9E3265EAD4A953A64C9936BD346746EBCC59E940A9D973A6CE9D3A6F7E365CDF02347DB99D59BD790BA72C5A9CB764697569E7B2E55357A4E7E636AE9CB26AF59A996B9B3B70E92B8D0686D7BA29EB0B80811BBD61E3A6E59B81FAA2139AEA13B66C5DB46D7B0E4E7D20AD207D407EEEBAC93B5AE702F59566CFD8B96BFAEE3DB3F612D407F254EEA4A5FBE683F595D6742CD8B17FD101DCFE43D6575A9B73F0D04CB0BED28EC373F6CC89995E43943E60B4C1F4E5361C397AEC787C2E69FA72A36BA373A6374D597382247DD17B4F9E2AE9A8CE9F72BAA486147D3967269F3D777EC285296DD978EDBB3865054CDFEEA9C0F45273296EEAA2CB57A65C3D82110F95C8FA8E5EBB7E03AA2FF5EA692033BAE0E6ADDBF3D2EED4A2A5CF1B77EFD522344697344EDC0561D6ECBB31B11A2434FDFE838725F00C915BFAE82E509FE6E327B1BBA72334D6E4E662303B7272E0B921B7F040EC81423B067B87DAA76B8ED61299DD7373B39F3D7FF1D2D189C1D9C5D5EDE9ABD76F1A88036F36BC7DE7EEE1E9C52020E8EDF3F249555C137120AEEA68B4AF9F90308388A8987FC0BE94FBC48205330283C4252419A4A46582ED43028807A161E1B272F20078ADAB485D1A81320000003B74455874436F6D6D656E740078723A643A4441462D315A55344C454D3A332C6A3A333038333133343837363834363432333539372C743A3234303330373133E437CC6B0000002574455874646174653A63726561746500323032342D30332D30375431333A35303A30352B30303A30300D3885730000002574455874646174653A6D6F6469667900323032342D30332D30375431333A35303A30352B30303A30307C653DCF0000002874455874646174653A74696D657374616D7000323032342D30332D30375431333A35303A31392B30303A3030207A76FA00000015744558747064663A417574686F72004DE1BBB92048E1BAAD75C519F9840000001574455874786D703A43726561746F72546F6F6C0043616E7661EAC712B10000000049454E44AE426082)
INSERT [dbo].[PhanLoai] ([MaPL], [MoTa], [BieuTuongPL]) VALUES (N'T16', N'T16 - Từ đủ 16 tuổi', N'Phim được phổ biến đến người xem từ đủ 16 tuổi trở lên', 0x89504E470D0A1A0A0000000D49484452000000370000001B0806000000D8B5170B000000206348524D00007A26000080840000FA00000080E8000075300000EA6000003A98000017709CBA513C00000006624B474400FF00FF00FFA0BDA793000000097048597300000EC400000EC401952B0E1B0000000774494D4507E803070D32138DA2F7DA000002B47A5458745261772070726F66696C65207479706520786D70000048C7955649B6E3200CDCEB147D049040C2C7F18077FD5E2FFBF85DC276BE130F71C72FC4040DA54212D0DFDF7FE8173E9193928C56A4B7A293059D345BD2C8C1E73A6A35F13599D8346AD25959B3F4CBFF2FE9994D2A859EC3FB03D30C25953E734A493FCC2E6B6EBA58C213A487A999AC7DB81AA4B8EA0C41E359A274FEE02D0863648CD36204BF621DCC028D159EDC010B39ACD0DFE102A86CA282796701EA1D42ACC0B9AE23685620429C0E94ED686C1F1294E418100C67181CB9D2168C0B62CC50CC4EA343076404C9555642CF703707BD2502DCE4CAE762AFF0A28E407E2343003D6AB785D16651AB9A87D1A80443AAA035BB29C7959316ED6A1CFA61C63F41077FA761C6AB681975089E412AA30C02C309567B279527F81519797ED10BD79FE86881F7237417C4C2A433722484DE05EFB7FC2E51E879A6DC270AFD644A8A2D43604CF998312D7FABEE64DCF0EAB2AA208F7482184AF29535E13A6BDE9C399FD05A24E92A73B220DC789F5D6BE26C7984F61111381473327084BD4060991B6F732B01AC7DC3482B48273A3B0318B1F9286754BD249EF02B6D34DFD58FD0765AA4E9111BD9407DEA5C1A99A452C4B09322586D6EB06B0E7B128FD9D41114F42205E19344F5370F0CDDA8CDB8AD1E91C10D6D7E1EA0424F5B6425C3A47F156307D3492221F60ED322E1C4D34BF5BB1B422D6367BC6C5F7BE6541F8C9EC9EDCDD3B1CECE6AFB53E69865B417BBCEDB6B935B9DD2F3FABE2F6F7A5EDFBBB32D1CCF36DA57F676967A352FC5BCA8ACC52CD7C56C81B6BED89A42F133456A9AD085870105998AF7E37EB2DC780967D28B61FA46E2530EE97F4ED33B0EE9FDDEE17792EBEE78C26141ED07E790EE3BE26A7ADF3010BC67399E116C8A9F8286738F1A2F5FC49FA4249DD1F9A9F6A55CDA2D8A2EFD1DEE71B895FD03AC7B4020900B433C000005DA4944415458C3D598DB8F1C4715C67FA7AABBA767EFF75DB37136C12120473117052524C80AC42072212041508222034248F0C03F020FBCF180C8031258821084896D21C538E1168264AC24E6B209246677B1BDB7D999D99DD99DE9AEAAC3C34C30BBECC56B1CADF349AD6E69AAEA9CEF9C535F9D1AD1B35F81CA0C957D45A28CC3AAD95368E80755DE311083C89498F48BC1BAC99EF97E38DC20E2E2051AB7F7E19697B049C70155372E262E8AEDDC6B8FAF0EAAA8AFA1EA41F309757E9262117EFA17A2E58994505B264D076F09BEF60468311E7C18DB731784C65EBBBE334C8A5B3A4D5E3ED38FBA276DD475B69ABE59E2CE9B88443964A3C2BB83AF7D9590DF6F3B6E27EAF930D9E209427306307BEDFE3608D8CE8344FDF7E3EB7F93905DFA9CBABA1A498F91FB69A99E3B3289867D408F2DDE4A3276145FFF2BD9FC33087EAFBDDF19A640327614897AC9667F44C82E2B980A62FE2ED53F3D501753E888068E10F57E045F3B4FBE781CC21A207BEDFA8E505524EA2519790C93DE8C2B3F8FABFC0EF0978DA06AE241E2BEC3E48B27C8E79F06BF1331B9CA67D35003660B2D56D0D09E6B5A82BD83688B08EA2A64B33FC0557F4F34F00968896188B46D50FD0A61F5755007B2D53E0B98F400F1C02741A2ED2CE2EB93B8F21920B4FD0E483A4132F428EAEB640BCF805FBE1204558807887AEEC6761C000C61ED0279F545342F2122DB9833109A84FA24F4DC0D2280B2C14369FFB0650D208577110F3F0AA6B02EE01B1325F634AEF27C4BAA5511DB4532F279E2A187098D69F2D249D42FB7970D98648CC2F837887AEF01B1AD05D561BB3F40E35FDF85BCB4BD6FF03F4989D81584D098269B3D06120360BB3F88EDBA03CD2BB8F219D4D701C1AFFD036D979849F7938C3C463C70648BC847C4439F26EAFB289ACD922D9E404C4A3CFC59A2BEC3C4B557C8178EB35B0DD81D39316D723FFC4FC20A266E917365B2F9A7D16C6E9D1351DF7D14C6BE8C294E40C85A93D62120C93EA2DE7B01C84A27C9E68E2192A0611593EC23640BA8985DCBDB2E33C7BADA5F6FAC2D2272454C04883A0F620AA3E44BCF41C889871E59BFA02A26BD19938CB4F7FD1B98F416C476E1CABF21E40BA07EDB3D77DDC8ED16AE761E579FC42F9F25197A68F380C5C3AD3DEC33E2C187B01DB78129A2D91CD9C2CFDBC2E4787BCBF25AC855FF08046433D56951434CDAFAB23DD8AE3BF12BE7C0A644DD775118FF1AEAABB8EA4BBBCEDEDBDE5B89B4A57ADBA8B78F0B947CF1591A53DFA231F56DDCF259241E20EEFB1862925DDBBE011A4745FD2AA0109AF8D5D7409BE0AA84D5495090741C4C079BA8D18D4E4ED06CB6455022C476FD1709DB4AB8866B5AF9BA90FBBF3A501142638AD098021313F51D460AFB91743FB6FBFD0084C63484FAAE2D5D0741910DEF1DC6CAC6BE5308F91279E914B6782B51EF3D98C218ADC37F026DCEE2CABF4243DEDEBBD74C4ED952D4368102EA2AF8C6454276B9D5976E83E057088D19B47909F4CA754A045CF9059A26251EFC14128F008AAF9D275BF819AE76FE2A89AD2FDF48DA6E8AED440AE384BCB48D6C6F64A7E4A553B8F2AF5175A8AB205BCD13C1557E8B5F7919D411D68D15D026D9E2B3B8EA1F907808F068364FC8CBED96723B7F1424C214F6B7CECBF64D225290E0CAB895974946BF802B8CE3964E03F98E044504FC4ABB0196AD89BD4520D4D150DB62AC20289ACFB75BB85640763EDB144C07F1E02344DD8770D59720ACD2EA58C594D5D76D36FFE382ADFF99C2E8130842563AD5CAE05595A85C31743DC6AE23B4CD3855909878F833D8E2019A979EC2AF5D00640DB19548888F62F43655FFA4AFBD7A6F86B1C9E8E3F8E60CDABCB863F6F6168AE9781FB6F30E9A17BF4F587B3313133F87443F017B41CAAF3E88AE4E13A7EF39A8A1FE3D45EF4B461F27EA3AD4BEBEDCD810DB4D5E79817CF12422D171B11DDFCC9A733326E946DC2F3F0EEF1D63E99FAF91F60D7F5D43F61DB15DA989FBB9B1B3F61602212BA1A15111937C29E07F51D46E62DF49746EA6C687D269E2813108FA3A6297D4D7FBBDAFBD93FE7116C4CC89446F881592190B0FDCC4BF01332C985070C2FA140000003B74455874436F6D6D656E740078723A643A4441462D315A55344C454D3A332C6A3A333038333133343837363834363432333539372C743A3234303330373133E437CC6B0000002574455874646174653A63726561746500323032342D30332D30375431333A35303A30362B30303A30303CD09FEE0000002574455874646174653A6D6F6469667900323032342D30332D30375431333A35303A30362B30303A30304D8D27520000002874455874646174653A74696D657374616D7000323032342D30332D30375431333A35303A31392B30303A3030207A76FA00000015744558747064663A417574686F72004DE1BBB92048E1BAAD75C519F9840000001574455874786D703A43726561746F72546F6F6C0043616E7661EAC712B10000000049454E44AE426082)
INSERT [dbo].[PhanLoai] ([MaPL], [MoTa], [BieuTuongPL]) VALUES (N'T18', N'T18 - Từ đủ 18 tuổi', N'Phim được phổ biến đến người xem từ đủ 18 tuổi trở lên', 0x89504E470D0A1A0A0000000D49484452000000370000001B0803000000EF6BE739000000206348524D00007A26000080840000FA00000080E8000075300000EA6000003A98000017709CBA513C000002A9504C5445CE2A2AFC3C3CFF3636FF3737FF5555FF5353FA3636FF4646FF0404FE2E2EFF3434FF0B0BFF2020FF3B3BFF3030FF3232FF3C3CFF2727FF4B4BFF2525FF3333FF5252FF3E3EFF4343FF5D5DFF7A7AFF3A3AFF3333FF3131FF3030FF3131FF3434FF3C3CFF3636FF3030FF3131FF3838FF3E3EFF3232FF3333FE3F3FFF3535FF3333FF2E2EFF2E2EFF3333FF3636FF3636FF3131FF3434FF3030FF3333FF2F2FFF3232FF3333FF3030FF3333FF3333FF2F2FFF2F2FFF3131FF3535FF3939FF3838FF3434FF2E2EFF3535FF3838FF3B3BFE4242FF3333FF3434FE4141FF3737FF3C3CFF3434FF3232FF3232FF3535FF3E3EFF3E3EFF5252FF5353FF5151FF3A3AFF3232FF9797FFC5C5FFB8B8FFC7C7FF8383FF2F2FFF6565FFC2C2FF5D5DFF4141FF4343FF6E6EFFC1C1FF5454FF3333FF6666FFC4C4FF7D7DFF3030FF3434FF9090FFBABAFF5858FF3131FF3D3DFF7C7CFF8C8CFFC3C3FF8989FF3737FF4F4FFF5F5FFF3838FF3636FF3535FF7171FF5050FFB9B9FF4444FF5E5EFFBEBEFFBDBDFFBFBFFF8A8AFF2E2EFF5B5BFFADADFF3939FF7878FFB3B3FF4242FF4545FF7272FFF5F5FFFEFEFFFFFFFFB2B2FF4646FFBCBCFFDEDEFF4848FFF4F4FFFDFDFFF1F1FFFAFAFF3C3CFF4A4AFF7F7FFF8282FFC6C6FFE9E9FF6464FF6060FFFCFCFFDDDDFF4747FF4C4CFFABABFF6161FF9191FFF3F3FFA0A0FFDADAFF2D2DFF7E7EFFE8E8FFEFEFFF5959FFEBEBFFEEEEFF2929FFD6D6FF7979FFA2A2FFDBDBFF9F9FFF9A9AFFD5D5FFF9F9FF8B8BFF4040FF6F6FFFEAEAFFA1A1FF8D8DFFE4E4FFD3D3FF8E8EFF6D6DFFE0E0FFF8F8FFDCDCFFA3A3FF8484FFECECFFE1E1FF4E4EFF2C2CFFB5B5FF8F8FFF4949FFF6F6FF6A6AFF9D9DFFDFDFFFB6B6FF5656FF8686FFCECEFFCDCDFF9898FFD1D1FFC8C8FF7070FF3B3BFF9292FFAAAAFF5757FF5555FF8787FF73738BDD36350000005074524E53000000000000000000000000000000000000000000000000000045E9F9F9FADA2A6CF8EF4E30C9B21F45C8FDFAB9633FE6D5F5E4F4E3E3F6E5D6FEFDEBC62C4CADF99C43281DB79E10603ED7E7E6C9267D2ACED400000001624B47448D1B0CE2D5000000097048597300000EC400000EC401952B0E1B0000000774494D4507E803070D32138DA2F7DA000002B67A5458745261772070726F66696C65207479706520786D70000048C7955649B69C300CDCEB1439822DD9121C87C1ECF25E96397E4A66F8345393E635DD808652B924437F7FFFA15FF8444E4A3258239D353A5AD051B3258D1CFC5A072D26FE4C46368D9A7452D62CDD7C7FB39ED8A450E8387C1E08CD7052E932A794F410767EE6A11B4B388274083591D50F178315179D60683C4994D60FFC0BC23833CEE31C04BF622DC2028D353C7A02167258A17BC20550D94405D7AD05B8B728B100E7F21C45B30211EA74A06CE760FB92E024E782103823E0C085D662DC10E70CC7EC343A744046915C6421F40A774DD05922C04DEE7C6DB695177500F2071B02E841DBB58C7A15B5A87919954A30A40A5AB387725C3969A36D897DD74FB813B4F7FFD44FF82BDA0CDA075790CA20BD207042D4CE49E51179930C3C6DF422F5111DCDF07E8C9E8A98997446CE84D0A7E1F3923F0985DE2BE55928F4A39414AB42104CF9AC98AADFA23B1B0FBCA42C2AD0918E30434B6EAA09F7AAF948E67CC26BB6A43BE56441B9F1595D8B70561D617C44140EC79C0C1C612D5058E6CADB545B00CFBE61A405A4139D9D019CB1F8686774BD241EF12BF56CBEAA87D2765EA4E9151BD9407D6ADD1ADF807B0D8EE0BA87FA91922463EA8C502E868C60D6480BC99962FA8085A65EC101CF61A1111A910B6448436B9E17A830D3665B24E7FA5587812198241270B4B8F4ACE74C9BEBF734845EC6CA78DB6E6BE6549F825ED9EDC3D3B9CFAE7AFB68735619EDCDEE757B1F72ED537ADFDFCFED4DEFFB7BB7B785F3DE46FBCE5EF752EFE6B9996797A599E5BE992DD03A17EB50687C4F9192464CE1BE4743A6C6E771375AAEBC842BEB39307D23F12D87F43FBBE91387F4F9DEE1EF24F7D3F182C306BD1F9C437A9E884BE8FDC040F1AE721C03D814DF050DFB1E555EBE98BF91245DD17974FBD22EF52D8A6EF39DDEE3F056F60F2F10403C4F62C343000002784944415438CB6360606492929691251EC8C92B30B3B032B0B173282A050406110B824394553859B918B8B855D542C3C22388059151D1EA1A3C4C0C9A8A5ADA31B171F109C481F8C4A4641D5D3D7D0603D994D4B4F40C6241746656764EAE922183515E586C7E66462E04C0A461BC5C34069019525058546CCC6052125E0A134E29838172103734242414A432BA22A418A13323B43236DE94C1A4AABA261A22125D1B51570F060D8D29B9B94DCDF52DF119B919AD6DED85D5451DD1308DD141D91D207DD99D50B39ABABA7B7A7A7B7B81445F454653FF84DE8993A27353B2264F993A6D5ACB74988DD1C968FA3266CC9C1535BB774ED6ACA8B9A115F392E6F72E58181DBD68C194C54B962E9B9ADA844B5F6E465353F4F2DE15FD2B9BA23356AD9EB606AC6FEDBAF5B51B3A364EDB845B1F086CEEDD3209C4DF3A67DBE61E90BE85DB77ECDCB57BCFBA79F8F5ED85EA5B529BB20F645F6E6ED7FEA907E64CDD57914194BE8CE8A683107D870ECF5F7F64EAD256E2F401E5C1FAA2938F4E3BD67CFCC4B2FC68D2F41D9F72F2D4E9F2EADE33E5A4E93BDB3BF1DCCA94F6DEFAB20C52F435759D3F7FB6FFC2C9DE8BB978ED3BD6BB00A6EF6CEFA549D119BB2E4F39BFE244EFC62B18FEAB8946D277F55A5F07545FDB7510337AE18D9B27B7F4C5C1553441D2E7A95BB733912C2CCEBB130A6596439819A11DA7CE15239275F1ACD8783306F3D6990D7743903422E73558C28D46084677ECCDEECAB460B054B60AAE3E1B1A4D24682ADB7BAFDFDAC696C1CEDEC1F17E6157D003E240D0AC09934C9C9C5D1878F95CDD321E2655130B921E59BB7BF00B30080A097B9A97C777100B7665DA388B888A308889337979FB18F8120D7CFCFC99252401619F838B151F62430000003B74455874436F6D6D656E740078723A643A4441462D315A55344C454D3A332C6A3A333038333133343837363834363432333539372C743A3234303330373133E437CC6B0000002574455874646174653A63726561746500323032342D30332D30375431333A35303A30362B30303A30303CD09FEE0000002574455874646174653A6D6F6469667900323032342D30332D30375431333A35303A30362B30303A30304D8D27520000002874455874646174653A74696D657374616D7000323032342D30332D30375431333A35303A31392B30303A3030207A76FA00000015744558747064663A417574686F72004DE1BBB92048E1BAAD75C519F9840000001574455874786D703A43726561746F72546F6F6C0043616E7661EAC712B10000000049454E44AE426082)
GO

CREATE TABLE TheLoai
(
	MaTL NVARCHAR(10) CONSTRAINT PK_TL_MaTL PRIMARY KEY(MaTL),
	TenTheLoai NVARCHAR(50) NOT NULL
)
GO

INSERT INTO TheLoai (MaTL, TenTheLoai) VALUES
(N'TL001', N'Tâm lý'),
(N'TL002', N'Tình cảm'),
(N'TL003', N'Hài hước'),
(N'TL004', N'Hành động'),
(N'TL005', N'Phiêu lưu'),
(N'TL006', N'Hoạt hình'),
(N'TL007', N'Kinh dị'),
(N'TL008', N'Hồi hộp'),
(N'TL009', N'Sử thi')
GO

CREATE TABLE Phim
(
	MaPhim NVARCHAR(10) CONSTRAINT PK_P_MaPhim PRIMARY KEY(MaPhim),
	TenPhim NVARCHAR(100) NOT NULL,
	MaPL NVARCHAR(10) CONSTRAINT FK_P_MaDP FOREIGN KEY(MaPL) REFERENCES PhanLoai(MaPL),
	DaoDien NVARCHAR(100),
	QuocGia NVARCHAR(100),
	ThoiLuong INT NOT NULL,
	NgayKhoiChieu DATE NOT NULL,
	MoTa NTEXT,
	Poster VARBINARY(MAX),
	Trailer NVARCHAR(100)
)
GO

INSERT INTO Phim (MaPhim, TenPhim, MaPL, DaoDien, QuocGia, ThoiLuong, NgayKhoiChieu, Poster, Trailer, MoTa) VALUES
(N'P001', N'Mai', N'T18', N'Trấn Thành', N'Việt Nam', 131, CONVERT(DATETIME, '02/10/2024'), NULL, N'https://youtu.be/EX6clvId19s', N'MAI xoay quanh câu chuyện về cuộc đời của một người phụ nữ cùng tên với bộ phim. Trên First-look Poster, Phương Anh Đào tạo ấn tượng mạnh với cái nhìn tĩnh lặng, xuyên thấu, đặc biệt, trên bờ môi nữ diễn viên là hình ảnh cô đang nằm nghiêng trên mặt nước. Được phủ một màn sương mờ ảo, poster đậm chất nghệ thuật của Mai gây tò mò với lời tựa: “Quá khứ chưa ngủ yên, ngày mai liệu sẽ đến?”.'),
(N'P002', N'Gặp Lại Chị Bầu', N'T13', N'Nhất Trung', N'Việt Nam', 114, CONVERT(DATETIME, '02/10/2024'), NULL, N'https://youtu.be/sJ0rRhTK84', N'Một chàng trai với với niềm đam mê diễn xuất nhưng lại có một quá khứ không bình yên, cùng cuộc gặp gỡ định mệnh với một cô giáo hơi " lố tuổi" , với câu chào đầu đầy ấn tượng " Em có ý gì với chị không?"'),
(N'P003', N'Đào, Phở Và Piano', N'T13', N'Phi Tiến Sơn', N'Việt Nam', 115, CONVERT(DATETIME, '02/22/2024'), NULL, NULL, N'Đào, Phở và Piano lấy bối cảnh trận chiến đông xuân kéo dài 60 ngày đêm từ cuối năm 1946 đến đầu năm 1947 ở Hà Nội. Câu chuyện theo chân chàng dân quân Văn Dân (Doãn Quốc Đam đóng) và chuyện tình với nàng tiểu thư đam mê dương cầm Thục Hương (Cao Thị Thùy Linh thủ vai).'),
(N'P004', N'Madame Web', N'T13', N'S.J. Clarkson', N'Mỹ', 116, CONVERT(DATETIME, '02/14/2024'), NULL, NULL, N'Bộ phim kể về nguồn gốc của một đồng minh Người Nhện, một nhân vật trong truyện tranh Marvel có sức mạnh liên kết đa vũ trụ - Madame Web. Sở hữu khả năng và giác quan nhạy bén của loài nhện, Cassandra có khả năng thấu thị, thần giao cách cảm và nhìn trước tương lai.'),
(N'P005', N'Gia Đình x Điệp Viên Mã: Trắng', N'T13', N'Kazuhiro Furuhashi', N'Nhật Bản', 111, CONVERT(DATETIME, '02/10/2024'), NULL, N'https://youtu.be/Vl7fCN5nuZ8', N'Bộ phim là phần phim điện ảnh của series anime nổi tiếng Spy x Family. Trong bộ phim lần này, sau khi nhận được yêu cầu thay thế mình trong Chiến dịch Strix, Loid Forger quyết định giúp con gái Anya chiến thắng trong cuộc thi nấu ăn tại Học viện Eden bằng cách nấu bữa ăn yêu thích của hiệu trưởng để tránh bị thay thế khỏi nhiệm vụ mật. Nhưng từ đây, gia đình Forger phát hiện ra bí mật kinh hoàng ảnh hưởng đến hòa bình thế giới.'),
(N'P006', N'Nàng Thơ Của Miller', N'T18', N'Jade Halley Bartlett', N'Mỹ', 93, CONVERT(DATETIME, '02/16/2024'), NULL, N'https://youtu.be/vk2OJZHutBM', N'Chuyện phim kể về 1 nữ sinh học giỏi nhưng đầy bí ẩn (Jenna Ortega) phải hoàn thành 1 dự án với giáo sư của mình (Martin Freeman). Giữa họ dần hình thành mối quan hệ phức tạp buộc cả 2 phải đấu tranh nhằm giữ vững những gì họ yêu quý khỏi trước những hành động sai lầm của bản thân.'),
(N'P007', N'Argylle Siêu Điệp Viên', N'T16', N'Matthew Vaughn', N'Mỹ', 139, CONVERT(DATETIME, '02/10/2024'), NULL, N'https://youtu.be/Qn4oyEnfo1U', N'Elly một tiểu thuyết gia nổi tiếng, trở thành một điệp viên bất đắc dĩ khi bị lôi kéo vào các hoạt động của một tập đoàn ngầm nham hiểm.'),
(N'P008', N'Gấu Đỏ Biến Hình', N'P', N'Domee Shi', N'Mỹ', 99, CONVERT(DATETIME, '02/10/2024'), NULL, N'https://youtu.be/gkTVd7X-iLk', N'"Turning Red - Gấu Đỏ Biến Hình" từ Disney và Pixar kể về Mei Lee, cô bé 13 tuổi tự tin và ngổ ngáo với những sự hỗn loạn của tuổi mới lớn. Mẹ của Mei luôn cố gắng bảo bọc và ở bên cạnh con gái mọi lúc mọi nơi, khiến cô bé cảm thấy như một thảm hoạ vậy. Và cứ như thể những thay đổi về sở thích, các mối quan hệ và thể chất còn chưa đủ, mỗi khi Mei trở nên quá phấn khích (mà thật ra lúc nào cũng vậy), "bùm", cô bé sẽ biến hình thành một chú gấu đỏ siêu cute khổng lồ luôn!'),
(N'P009', N'Cún Cưng Đại Náo Nhà Hát', N'P', N'Vasiliy Rovenskiy', N'Nga', 75, CONVERT(DATETIME, '02/16/2024'), NULL, N'https://youtu.be/awMUW5_AlFY', N'Chú chó lang tham Samson vô tình lạc vào nhà hát opera Bolshoi nổi tiếng bậc nhất thủ đô Moscow hoa lệ. Vướng vào vụ trộm chiếc vương miện kim cương của nữ diễn viên Anastasia; Samson cùng nàng cún Margot xinh đẹp của Anastasia dấn thân vào cuộc phiêu lưu đại náo nhà hát, truy lùng bọn cướp và giành lại món nữ trang quý giá.'),
(N'P010', N'Pororo: Hành Trình Siêu Sao Âm Nhạc', N'P', N'Yoon Je-wan', N'Hàn Quốc', 77, CONVERT(DATETIME, '02/23/2024'), NULL, N'https://youtu.be/c5zapDM66P8', N'Pororo và những người bạn của anh ấy sắp sửa chiến thắng trong một cuộc thi ca hát mà họ tham gia cho vui. Liệu Pororo và những người bạn của anh ấy có thoát khỏi sự phiền nhiễu của Big Ben và cuối cùng giành chiến thắng trong cuộc thi siêu sao âm nhạc?')
GO

CREATE TRIGGER SetPosterToNullOnEmpty
ON Phim
AFTER INSERT, UPDATE
AS
BEGIN
    SET NOCOUNT ON;

    UPDATE Phim
    SET Poster = NULL
    FROM Phim
    INNER JOIN inserted ON Phim.MaPhim = inserted.MaPhim
    WHERE inserted.Poster IS NOT NULL AND DATALENGTH(inserted.Poster) = 0;
END
GO

CREATE FUNCTION f_AutoMaPhim()
RETURNS VARCHAR(10)
AS
BEGIN
    DECLARE @MaPhim VARCHAR(10)

    IF NOT EXISTS (SELECT * FROM Phim)
		BEGIN
			SET @MaPhim = 'P001'
		END
    ELSE
		BEGIN
			DECLARE @MaxMaPhim INT
			SELECT @MaxMaPhim = MAX(RIGHT(MaPhim, 3)) FROM Phim
			SET @MaPhim = 'P' + RIGHT('000' + CAST(@MaxMaPhim + 1 AS VARCHAR(3)), 3)
		END

    RETURN @MaPhim
END
GO

CREATE TABLE TheLoai_Phim
(
	MaPhim NVARCHAR(10) CONSTRAINT FK_TLP_MaPhim FOREIGN KEY(MaPhim) REFERENCES Phim(MaPhim) ON DELETE CASCADE,
	MaTL NVARCHAR(10) CONSTRAINT FK_TLP_MaTL FOREIGN KEY(MaTL) REFERENCES TheLoai(MaTL),
	CONSTRAINT PK_TLP_MaPhim_MaTL PRIMARY KEY(MaPhim, MaTL)
)
GO

INSERT [dbo].[TheLoai_Phim] ([MaPhim], [MaTL]) VALUES (N'P001', N'TL001')
INSERT [dbo].[TheLoai_Phim] ([MaPhim], [MaTL]) VALUES (N'P001', N'TL002')
INSERT [dbo].[TheLoai_Phim] ([MaPhim], [MaTL]) VALUES (N'P002', N'TL002')
INSERT [dbo].[TheLoai_Phim] ([MaPhim], [MaTL]) VALUES (N'P002', N'TL003')
INSERT [dbo].[TheLoai_Phim] ([MaPhim], [MaTL]) VALUES (N'P003', N'TL004')
INSERT [dbo].[TheLoai_Phim] ([MaPhim], [MaTL]) VALUES (N'P003', N'TL005')
INSERT [dbo].[TheLoai_Phim] ([MaPhim], [MaTL]) VALUES (N'P004', N'TL002')
INSERT [dbo].[TheLoai_Phim] ([MaPhim], [MaTL]) VALUES (N'P004', N'TL009')
INSERT [dbo].[TheLoai_Phim] ([MaPhim], [MaTL]) VALUES (N'P005', N'TL003')
INSERT [dbo].[TheLoai_Phim] ([MaPhim], [MaTL]) VALUES (N'P005', N'TL006')
INSERT [dbo].[TheLoai_Phim] ([MaPhim], [MaTL]) VALUES (N'P006', N'TL002')
INSERT [dbo].[TheLoai_Phim] ([MaPhim], [MaTL]) VALUES (N'P006', N'TL003')
INSERT [dbo].[TheLoai_Phim] ([MaPhim], [MaTL]) VALUES (N'P007', N'TL003')
INSERT [dbo].[TheLoai_Phim] ([MaPhim], [MaTL]) VALUES (N'P007', N'TL004')
INSERT [dbo].[TheLoai_Phim] ([MaPhim], [MaTL]) VALUES (N'P008', N'TL006')
INSERT [dbo].[TheLoai_Phim] ([MaPhim], [MaTL]) VALUES (N'P009', N'TL005')
INSERT [dbo].[TheLoai_Phim] ([MaPhim], [MaTL]) VALUES (N'P009', N'TL006')
INSERT [dbo].[TheLoai_Phim] ([MaPhim], [MaTL]) VALUES (N'P010', N'TL005')
INSERT [dbo].[TheLoai_Phim] ([MaPhim], [MaTL]) VALUES (N'P010', N'TL006')
GO

CREATE VIEW vwDanhSachPhim AS
SELECT p.MaPhim, p.TenPhim, p.MaPL,	pl.BieuTuongPL, p.DaoDien, p.QuocGia, p.ThoiLuong, p.NgayKhoiChieu, p.MoTa, p.Poster, p.Trailer,
(SELECT STRING_AGG(tl.TenTheLoai, ', ')
FROM TheLoai_Phim AS tlp INNER JOIN TheLoai AS tl ON tlp.MaTL = tl.MaTL
WHERE tlp.MaPhim = p.MaPhim) AS 'TheLoaiPhim'
FROM Phim AS p LEFT JOIN PhanLoai AS pl ON p.MaPL = pl.MaPL

--CREATE TABLE LoaiTaiKhoan
--(
--	MaLTK NVARCHAR(10) CONSTRAINT PK_LTK_MaLTK PRIMARY KEY(MaLTK),
--	LoaiTK NVARCHAR(10) NOT NULL
--)
--GO

--INSERT INTO LoaiTaiKhoan (MaLTK, LoaiTK) VALUES
--(N'QL', N'Quản lý'),
--(N'NV', N'Nhân viên'),
--(N'KH', N'Khách hàng')
--GO

--CREATE TABLE TaiKhoan
--(
--	MaTK NVARCHAR(10) CONSTRAINT PK_TK_MaTK PRIMARY KEY(MaTK),
--	UserName NVARCHAR(100) NOT NULL,
--	PassWord NVARCHAR(1000) NOT NULL,
--	MaLTK NVARCHAR(10) CONSTRAINT FK_TK_MaLTK FOREIGN KEY(MaLTK) REFERENCES LoaiTaiKhoan(MaLTK)
--)
--GO

--INSERT INTO TaiKhoan (MaTK, UserName, PassWord, MaLTK) VALUES
--(N'TK001', N'admin', N'123', N'QL'),
--(N'TK002', N'nhanvien', N'123', N'NV'),
--(N'TK003', N'khachhang', N'123', N'KH')
--GO

CREATE PROC sp_Login @userName NVARCHAR(10), @passWord NVARCHAR(10)
AS
BEGIN
	SELECT * FROM NhanVien WHERE Email = @userName AND MatKhau = @passWord
END
GO

CREATE TABLE PhongChieu
(
	MaPhong NVARCHAR(10) CONSTRAINT PK_PC_MaPhong PRIMARY KEY(MaPhong),
	TenPhong NVARCHAR(100) NOT NULL,
	ViTri NVARCHAR(100),
	SucChua INT
)
GO

INSERT INTO PhongChieu(MaPhong, TenPhong, ViTri, SucChua) VALUES
(N'PC001', N'Phòng 1', NULL, NULL),
(N'PC002', N'Phòng 2', NULL, NULL),
(N'PC003', N'Phòng 3', NULL, NULL),
(N'PC004', N'Phòng 4', NULL, NULL),
(N'PC005', N'Phòng 5', NULL, NULL)
GO

CREATE TABLE LoaiGhe
(
	MaLoaiGhe NVARCHAR(10) CONSTRAINT PK_LG_MaGhe PRIMARY KEY(MaLoaiGhe),
	TenLoaiGhe NVARCHAR(100) NOT NULL,
	Gia INT NOT NULL
)
GO

INSERT INTO LoaiGhe(MaLoaiGhe, TenLoaiGhe, Gia) VALUES
(N'GTHG', N'Ghế thường', 50000),
(N'GVIP', N'Ghế VIP', 70000),
(N'GDOI', N'Ghế đôi', 120000)
GO

CREATE TABLE Ghe
(
	MaGhe NVARCHAR(10) CONSTRAINT PK_G_MaGhe PRIMARY KEY(MaGhe),
	MaPhong NVARCHAR(10) CONSTRAINT FK_G_MaPhong FOREIGN KEY(MaPhong) REFERENCES PhongChieu(MaPhong),
	MaLoaiGhe NVARCHAR(10) CONSTRAINT FK_G_MaLoaiGhe FOREIGN KEY(MaLoaiGhe) REFERENCES LoaiGhe(MaLoaiGhe),
)
GO

INSERT INTO Ghe(MaGhe, MaPhong, MaLoaiGhe) VALUES
(N'A101', N'PC001', N'GTHG'),
(N'A102', N'PC001', N'GTHG'),
(N'A103', N'PC001', N'GTHG'),
(N'A104', N'PC001', N'GTHG'),
(N'A105', N'PC001', N'GTHG'),
(N'A106', N'PC001', N'GTHG'),
(N'A107', N'PC001', N'GTHG'),
(N'A108', N'PC001', N'GTHG'),
(N'A109', N'PC001', N'GTHG'),
(N'A110', N'PC001', N'GTHG'),
(N'B101', N'PC001', N'GTHG'),
(N'B102', N'PC001', N'GTHG'),
(N'B103', N'PC001', N'GTHG'),
(N'B104', N'PC001', N'GTHG'),
(N'B105', N'PC001', N'GTHG'),
(N'B106', N'PC001', N'GTHG'),
(N'B107', N'PC001', N'GTHG'),
(N'B108', N'PC001', N'GTHG'),
(N'B109', N'PC001', N'GTHG'),
(N'B110', N'PC001', N'GTHG'),
(N'C101', N'PC001', N'GTHG'),
(N'C102', N'PC001', N'GTHG'),
(N'C103', N'PC001', N'GVIP'),
(N'C104', N'PC001', N'GVIP'),
(N'C105', N'PC001', N'GVIP'),
(N'C106', N'PC001', N'GVIP'),
(N'C107', N'PC001', N'GVIP'),
(N'C108', N'PC001', N'GVIP'),
(N'C109', N'PC001', N'GTHG'),
(N'C110', N'PC001', N'GTHG'),
(N'D101', N'PC001', N'GTHG'),
(N'D102', N'PC001', N'GTHG'),
(N'D103', N'PC001', N'GVIP'),
(N'D104', N'PC001', N'GVIP'),
(N'D105', N'PC001', N'GVIP'),
(N'D106', N'PC001', N'GVIP'),
(N'D107', N'PC001', N'GVIP'),
(N'D108', N'PC001', N'GVIP'),
(N'D109', N'PC001', N'GTHG'),
(N'D110', N'PC001', N'GTHG'),
(N'E101', N'PC001', N'GTHG'),
(N'E102', N'PC001', N'GTHG'),
(N'E103', N'PC001', N'GVIP'),
(N'E104', N'PC001', N'GVIP'),
(N'E105', N'PC001', N'GVIP'),
(N'E106', N'PC001', N'GVIP'),
(N'E107', N'PC001', N'GVIP'),
(N'E108', N'PC001', N'GVIP'),
(N'E109', N'PC001', N'GTHG'),
(N'E110', N'PC001', N'GTHG'),
(N'F101', N'PC001', N'GDOI'),
(N'F102', N'PC001', N'GDOI'),
(N'F103', N'PC001', N'GDOI'),
(N'F104', N'PC001', N'GDOI'),
(N'F105', N'PC001', N'GDOI'),

(N'A201', N'PC002', N'GTHG'),
(N'A202', N'PC002', N'GTHG'),
(N'A203', N'PC002', N'GTHG'),
(N'A204', N'PC002', N'GTHG'),
(N'A205', N'PC002', N'GTHG'),
(N'A206', N'PC002', N'GTHG'),
(N'A207', N'PC002', N'GTHG'),
(N'A208', N'PC002', N'GTHG'),
(N'A209', N'PC002', N'GTHG'),
(N'A210', N'PC002', N'GTHG'),
(N'B201', N'PC002', N'GTHG'),
(N'B202', N'PC002', N'GTHG'),
(N'B203', N'PC002', N'GTHG'),
(N'B204', N'PC002', N'GTHG'),
(N'B205', N'PC002', N'GTHG'),
(N'B206', N'PC002', N'GTHG'),
(N'B207', N'PC002', N'GTHG'),
(N'B208', N'PC002', N'GTHG'),
(N'B209', N'PC002', N'GTHG'),
(N'B210', N'PC002', N'GTHG'),
(N'C201', N'PC002', N'GTHG'),
(N'C202', N'PC002', N'GTHG'),
(N'C203', N'PC002', N'GVIP'),
(N'C204', N'PC002', N'GVIP'),
(N'C205', N'PC002', N'GVIP'),
(N'C206', N'PC002', N'GVIP'),
(N'C207', N'PC002', N'GVIP'),
(N'C208', N'PC002', N'GVIP'),
(N'C209', N'PC002', N'GTHG'),
(N'C210', N'PC002', N'GTHG'),
(N'D201', N'PC002', N'GTHG'),
(N'D202', N'PC002', N'GTHG'),
(N'D203', N'PC002', N'GVIP'),
(N'D204', N'PC002', N'GVIP'),
(N'D205', N'PC002', N'GVIP'),
(N'D206', N'PC002', N'GVIP'),
(N'D207', N'PC002', N'GVIP'),
(N'D208', N'PC002', N'GVIP'),
(N'D209', N'PC002', N'GTHG'),
(N'D210', N'PC002', N'GTHG'),
(N'E201', N'PC002', N'GTHG'),
(N'E202', N'PC002', N'GTHG'),
(N'E203', N'PC002', N'GVIP'),
(N'E204', N'PC002', N'GVIP'),
(N'E205', N'PC002', N'GVIP'),
(N'E206', N'PC002', N'GVIP'),
(N'E207', N'PC002', N'GVIP'),
(N'E208', N'PC002', N'GVIP'),
(N'E209', N'PC002', N'GTHG'),
(N'E210', N'PC002', N'GTHG'),
(N'F201', N'PC002', N'GDOI'),
(N'F202', N'PC002', N'GDOI'),
(N'F203', N'PC002', N'GDOI'),
(N'F204', N'PC002', N'GDOI'),
(N'F205', N'PC002', N'GDOI'),

(N'A301', N'PC003', N'GTHG'),
(N'A302', N'PC003', N'GTHG'),
(N'A303', N'PC003', N'GTHG'),
(N'A304', N'PC003', N'GTHG'),
(N'A305', N'PC003', N'GTHG'),
(N'A306', N'PC003', N'GTHG'),
(N'A307', N'PC003', N'GTHG'),
(N'A308', N'PC003', N'GTHG'),
(N'A309', N'PC003', N'GTHG'),
(N'A310', N'PC003', N'GTHG'),
(N'B301', N'PC003', N'GTHG'),
(N'B302', N'PC003', N'GTHG'),
(N'B303', N'PC003', N'GTHG'),
(N'B304', N'PC003', N'GTHG'),
(N'B305', N'PC003', N'GTHG'),
(N'B306', N'PC003', N'GTHG'),
(N'B307', N'PC003', N'GTHG'),
(N'B308', N'PC003', N'GTHG'),
(N'B309', N'PC003', N'GTHG'),
(N'B310', N'PC003', N'GTHG'),
(N'C301', N'PC003', N'GTHG'),
(N'C302', N'PC003', N'GTHG'),
(N'C303', N'PC003', N'GVIP'),
(N'C304', N'PC003', N'GVIP'),
(N'C305', N'PC003', N'GVIP'),
(N'C306', N'PC003', N'GVIP'),
(N'C307', N'PC003', N'GVIP'),
(N'C308', N'PC003', N'GVIP'),
(N'C309', N'PC003', N'GTHG'),
(N'C310', N'PC003', N'GTHG'),
(N'D301', N'PC003', N'GTHG'),
(N'D302', N'PC003', N'GTHG'),
(N'D303', N'PC003', N'GVIP'),
(N'D304', N'PC003', N'GVIP'),
(N'D305', N'PC003', N'GVIP'),
(N'D306', N'PC003', N'GVIP'),
(N'D307', N'PC003', N'GVIP'),
(N'D308', N'PC003', N'GVIP'),
(N'D309', N'PC003', N'GTHG'),
(N'D310', N'PC003', N'GTHG'),
(N'E301', N'PC003', N'GTHG'),
(N'E302', N'PC003', N'GTHG'),
(N'E303', N'PC003', N'GVIP'),
(N'E304', N'PC003', N'GVIP'),
(N'E305', N'PC003', N'GVIP'),
(N'E306', N'PC003', N'GVIP'),
(N'E307', N'PC003', N'GVIP'),
(N'E308', N'PC003', N'GVIP'),
(N'E309', N'PC003', N'GTHG'),
(N'E310', N'PC003', N'GTHG'),
(N'F301', N'PC003', N'GDOI'),
(N'F302', N'PC003', N'GDOI'),
(N'F303', N'PC003', N'GDOI'),
(N'F304', N'PC003', N'GDOI'),
(N'F305', N'PC003', N'GDOI'),

(N'A401', N'PC004', N'GTHG'),
(N'A402', N'PC004', N'GTHG'),
(N'A403', N'PC004', N'GTHG'),
(N'A404', N'PC004', N'GTHG'),
(N'A405', N'PC004', N'GTHG'),
(N'A406', N'PC004', N'GTHG'),
(N'A407', N'PC004', N'GTHG'),
(N'A408', N'PC004', N'GTHG'),
(N'A409', N'PC004', N'GTHG'),
(N'A410', N'PC004', N'GTHG'),
(N'B401', N'PC004', N'GTHG'),
(N'B402', N'PC004', N'GTHG'),
(N'B403', N'PC004', N'GTHG'),
(N'B404', N'PC004', N'GTHG'),
(N'B405', N'PC004', N'GTHG'),
(N'B406', N'PC004', N'GTHG'),
(N'B407', N'PC004', N'GTHG'),
(N'B408', N'PC004', N'GTHG'),
(N'B409', N'PC004', N'GTHG'),
(N'B410', N'PC004', N'GTHG'),
(N'C401', N'PC004', N'GTHG'),
(N'C402', N'PC004', N'GTHG'),
(N'C403', N'PC004', N'GVIP'),
(N'C404', N'PC004', N'GVIP'),
(N'C405', N'PC004', N'GVIP'),
(N'C406', N'PC004', N'GVIP'),
(N'C407', N'PC004', N'GVIP'),
(N'C408', N'PC004', N'GVIP'),
(N'C409', N'PC004', N'GTHG'),
(N'C410', N'PC004', N'GTHG'),
(N'D401', N'PC004', N'GTHG'),
(N'D402', N'PC004', N'GTHG'),
(N'D403', N'PC004', N'GVIP'),
(N'D404', N'PC004', N'GVIP'),
(N'D405', N'PC004', N'GVIP'),
(N'D406', N'PC004', N'GVIP'),
(N'D407', N'PC004', N'GVIP'),
(N'D408', N'PC004', N'GVIP'),
(N'D409', N'PC004', N'GTHG'),
(N'D410', N'PC004', N'GTHG'),
(N'E401', N'PC004', N'GTHG'),
(N'E402', N'PC004', N'GTHG'),
(N'E403', N'PC004', N'GVIP'),
(N'E404', N'PC004', N'GVIP'),
(N'E405', N'PC004', N'GVIP'),
(N'E406', N'PC004', N'GVIP'),
(N'E407', N'PC004', N'GVIP'),
(N'E408', N'PC004', N'GVIP'),
(N'E409', N'PC004', N'GTHG'),
(N'E410', N'PC004', N'GTHG'),
(N'F401', N'PC004', N'GDOI'),
(N'F402', N'PC004', N'GDOI'),
(N'F403', N'PC004', N'GDOI'),
(N'F404', N'PC004', N'GDOI'),
(N'F405', N'PC004', N'GDOI'),

(N'A501', N'PC005', N'GTHG'),
(N'A502', N'PC005', N'GTHG'),
(N'A503', N'PC005', N'GTHG'),
(N'A504', N'PC005', N'GTHG'),
(N'A505', N'PC005', N'GTHG'),
(N'A506', N'PC005', N'GTHG'),
(N'A507', N'PC005', N'GTHG'),
(N'A508', N'PC005', N'GTHG'),
(N'A509', N'PC005', N'GTHG'),
(N'A510', N'PC005', N'GTHG'),
(N'B501', N'PC005', N'GTHG'),
(N'B502', N'PC005', N'GTHG'),
(N'B503', N'PC005', N'GTHG'),
(N'B504', N'PC005', N'GTHG'),
(N'B505', N'PC005', N'GTHG'),
(N'B506', N'PC005', N'GTHG'),
(N'B507', N'PC005', N'GTHG'),
(N'B508', N'PC005', N'GTHG'),
(N'B509', N'PC005', N'GTHG'),
(N'B510', N'PC005', N'GTHG'),
(N'C501', N'PC005', N'GTHG'),
(N'C502', N'PC005', N'GTHG'),
(N'C503', N'PC005', N'GVIP'),
(N'C504', N'PC005', N'GVIP'),
(N'C505', N'PC005', N'GVIP'),
(N'C506', N'PC005', N'GVIP'),
(N'C507', N'PC005', N'GVIP'),
(N'C508', N'PC005', N'GVIP'),
(N'C509', N'PC005', N'GTHG'),
(N'C510', N'PC005', N'GTHG'),
(N'D501', N'PC005', N'GTHG'),
(N'D502', N'PC005', N'GTHG'),
(N'D503', N'PC005', N'GVIP'),
(N'D504', N'PC005', N'GVIP'),
(N'D505', N'PC005', N'GVIP'),
(N'D506', N'PC005', N'GVIP'),
(N'D507', N'PC005', N'GVIP'),
(N'D508', N'PC005', N'GVIP'),
(N'D509', N'PC005', N'GTHG'),
(N'D510', N'PC005', N'GTHG'),
(N'E501', N'PC005', N'GTHG'),
(N'E502', N'PC005', N'GTHG'),
(N'E503', N'PC005', N'GVIP'),
(N'E504', N'PC005', N'GVIP'),
(N'E505', N'PC005', N'GVIP'),
(N'E506', N'PC005', N'GVIP'),
(N'E507', N'PC005', N'GVIP'),
(N'E508', N'PC005', N'GVIP'),
(N'E509', N'PC005', N'GTHG'),
(N'E510', N'PC005', N'GTHG'),
(N'F501', N'PC005', N'GDOI'),
(N'F502', N'PC005', N'GDOI'),
(N'F503', N'PC005', N'GDOI'),
(N'F504', N'PC005', N'GDOI'),
(N'F505', N'PC005', N'GDOI')

CREATE TABLE SuatChieu
(
	MaSC NVARCHAR(10) CONSTRAINT PK_SC_MaSC PRIMARY KEY(MaSC),
	MaPhong NVARCHAR(10) CONSTRAINT FK_SC_MaPhong FOREIGN KEY(MaPhong) REFERENCES PhongChieu(MaPhong),
	MaPhim NVARCHAR(10) CONSTRAINT FK_SC_MaPhim FOREIGN KEY(MaPhim) REFERENCES Phim(MaPhim),
	ThoiGian DATETIME NOT NULL
)
GO

CREATE TRIGGER tgKiemTraTrungThoiGianChieu
ON SuatChieu
AFTER INSERT, UPDATE
AS
BEGIN
    IF EXISTS (
        SELECT 1
        FROM inserted i
        JOIN Phim p ON i.MaPhim = p.MaPhim
        JOIN vwSuatChieu sc ON i.MaPhong = sc.MaPhong
			AND (
				(i.ThoiGian BETWEEN sc.ThoiGian AND sc.GioKetThuc)
				OR (DATEADD(MINUTE, p.ThoiLuong, i.ThoiGian) BETWEEN sc.ThoiGian AND sc.GioKetThuc)
			)
			AND i.MaSC <> sc.MaSC
    )
    BEGIN
        RAISERROR ('Khung giờ chiếu phim mới trùng lặp với suất chiếu đang tồn tại.', 16, 1)
        ROLLBACK TRANSACTION
    END
END
GO

CREATE TABLE ChiTietSuatChieu
(
	MaSC NVARCHAR(10) CONSTRAINT FK_CTSC_MaSC FOREIGN KEY(MaSC) REFERENCES SuatChieu(MaSC) ON DELETE CASCADE,
	MaGhe NVARCHAR(10) CONSTRAINT FK_CTSC_MaGhe FOREIGN KEY(MaGhe) REFERENCES Ghe(MaGhe),
	TinhTrang NVARCHAR(10) CONSTRAINT CK_CTSC_TinhTrang CHECK (TinhTrang IN(N'Trống', N'Đã đặt')),
	CONSTRAINT PK_CTSC_MaSC_MaGhe PRIMARY KEY(MaSC, MaGhe)
)
GO

CREATE TRIGGER tgAutoInsertChiTietSuatChieu
ON SuatChieu
AFTER INSERT
AS
BEGIN
    SET NOCOUNT ON;
    INSERT INTO ChiTietSuatChieu (MaSC, MaGhe, TinhTrang)
    SELECT i.MaSC, g.MaGhe, N'Trống'
    FROM inserted i CROSS JOIN Ghe g
	WHERE i.MaPhong = g.MaPhong AND MaSC = i.MaSC
END
GO

INSERT INTO SuatChieu(MaSC, MaPhong, MaPhim, ThoiGian) VALUES
(N'SC001', N'PC001', N'P001', '2024-03-09 12:30:00'),
(N'SC002', N'PC001', N'P002', '2024-03-09 15:00:00'),
(N'SC003', N'PC001', N'P003', '2024-03-09 18:45:00'),
(N'SC004', N'PC001', N'P001', '2024-03-09 21:00:00'),
(N'SC005', N'PC002', N'P002', '2024-03-09 12:00:00'),
(N'SC006', N'PC002', N'P003', '2024-03-09 15:50:00'),
(N'SC007', N'PC003', N'P005', '2024-03-09 18:00:00'),
(N'SC008', N'PC003', N'P007', '2024-03-09 15:30:00'),
(N'SC009', N'PC003', N'P008', '2024-03-09 21:00:00'),
(N'SC010', N'PC004', N'P002', '2024-03-09 17:00:00'),
(N'SC011', N'PC004', N'P005', '2024-03-09 19:50:00'),
(N'SC012', N'PC005', N'P004', '2024-03-09 23:00:00'),
(N'SC013', N'PC001', N'P001', '2024-03-13 12:30:00'),
(N'SC014', N'PC001', N'P002', '2024-03-23 15:00:00'),
(N'SC015', N'PC001', N'P003', '2024-03-23 18:45:00'),
(N'SC016', N'PC002', N'P001', '2024-03-09 22:00:00'),
(N'SC017', N'PC002', N'P002', '2024-03-19 12:00:00'),
(N'SC018', N'PC002', N'P003', '2024-03-13 15:50:00'),
(N'SC019', N'PC003', N'P005', '2024-03-17 18:00:00'),
(N'SC020', N'PC003', N'P007', '2024-03-23 15:30:00'),
(N'SC021', N'PC003', N'P008', '2024-03-13 19:00:00'),
(N'SC022', N'PC004', N'P002', '2024-03-23 17:00:00'),
(N'SC023', N'PC004', N'P005', '2024-03-09 12:50:00'),
(N'SC024', N'PC005', N'P004', '2024-03-15 23:00:00')
GO

CREATE FUNCTION f_AutoMaSC()
RETURNS VARCHAR(10)
AS
BEGIN
    DECLARE @MaSC VARCHAR(10)

    IF NOT EXISTS (SELECT * FROM SuatChieu)
		BEGIN
			SET @MaSC = 'SC001'
		END
    ELSE
		BEGIN
			DECLARE @MaxMaSC INT
			SELECT @MaxMaSC = MAX(RIGHT(MaSC, 3)) FROM SuatChieu
			SET @MaSC = 'SC' + RIGHT('000' + CAST(@MaxMaSC + 1 AS VARCHAR(3)), 3)
		END

    RETURN @MaSC
END
GO

CREATE FUNCTION f_AutoMaTL()
RETURNS VARCHAR(10)
AS
BEGIN
    DECLARE @MaTL VARCHAR(10)

    IF NOT EXISTS (SELECT * FROM TheLoai)
		BEGIN
			SET @MaTL = 'TL001'
		END
    ELSE
		BEGIN
			DECLARE @MaxMaTL INT
			SELECT @MaxMaTL = MAX(RIGHT(MaTL, 3)) FROM TheLoai
			SET @MaTL = 'TL' + RIGHT('000' + CAST(@MaxMaTL + 1 AS VARCHAR(3)), 3)
		END

    RETURN @MaTL
END
GO

CREATE VIEW vwDanhSachLichChieu AS
SELECT sc.MaSC, pc.MaPhong, pc.TenPhong, p.MaPhim, p.TenPhim, sc.ThoiGian, ThoiLuong, COUNT(CASE WHEN ctsc.TinhTrang = N'Trống' THEN ctsc.MaGhe END) AS SoGheTrong, COUNT(ctsc.MaGhe) AS TongSoGhe
FROM PhongChieu pc
JOIN SuatChieu sc ON pc.MaPhong = sc.MaPhong
JOIN Phim p ON sc.MaPhim = p.MaPhim
LEFT JOIN ChiTietSuatChieu ctsc ON sc.MaSC = ctsc.MaSC
GROUP BY sc.MaSC, pc.MaPhong, pc.TenPhong, p.MaPhim, p.TenPhim, sc.ThoiGian, ThoiLuong
GO

CREATE VIEW vwSuatChieu AS
SELECT sc.*, DATEADD(MINUTE, p.ThoiLuong, sc.ThoiGian) AS GioKetThuc
FROM SuatChieu sc JOIN Phim p ON sc.MaPhim = p.MaPhim
GO

CREATE TABLE ChucVu
(
	MaCV NVARCHAR(10) CONSTRAINT PK_CV_MaCV PRIMARY KEY(MaCV),
	TenCV NVARCHAR(50) NOT NULL
)
GO

INSERT INTO ChucVu(MaCV, TenCV) VALUES
(N'NV', N'Nhân viên'),
(N'QL', N'Quản lý')
GO

CREATE TABLE NhanVien
(
	MaNV NVARCHAR(10) CONSTRAINT PK_NV_MaNV PRIMARY KEY(MaNV),
	HoNV NVARCHAR(50),
	TenNV NVARCHAR(50),
	NgaySinh DATE,
	GioiTinh NVARCHAR(10),
	NgayVaoLam DATE,
	MaCV NVARCHAR(10), CONSTRAINT FK_NV_MaCV FOREIGN KEY(MaCV) REFERENCES ChucVu(MaCV),
	DienThoai NVARCHAR(15),
	Email NVARCHAR(50),
	MatKhau VARCHAR(100),
	DiaChi NVARCHAR(100)
)
GO

INSERT INTO NhanVien(MaNV, TenNV, MaCV, Email, MatKhau) VALUES
(N'ADMIN', N'Admin', N'QL', N'admin', '123456'),
(N'NV000', N'Nhân viên', N'NV', N'nhanvien', '123456')
GO

INSERT INTO NhanVien(MaNV, HoNV, TenNV, NgaySinh, GioiTinh, NgayVaoLam, MaCV, DienThoai, Email, MatKhau, DiaChi) VALUES 
(N'NV001', N'Nguyễn Văn', N'Anh', '1990-01-15', N'Nam', N'2024-01-15', N'NV', N'0843652384', N'nguyenvananh@email.com', '123456', N'123 Đường Lê Lợi, Phường 1, Quận 5, TP. Hồ Chí Minh'),
(N'NV002', N'Trần Thị', N'Bình', '1985-05-22', N'Nữ', N'2023-04-30', N'NV', N'0952857496', N'tranthibinh@email.com', '123456', N'456 Đường Nguyễn Huệ, Phường 2, Quận 10, TP. Hồ Chí Minh'),
(N'NV003', N'Lê Văn', N'Cường', '1992-03-10', N'Nam', N'2024-03-16', N'NV', N'03648720195', N'levancuong@email.com', '123456', N'789 Đường Nam Kỳ Khởi Nghĩa, Phường 3, Quận 3, TP. Hồ Chí Minh'),
(N'NV004', N'Phạm Thị Diệu', N'Linh', '1988-07-05', N'Nữ', N'2022-11-15', N'NV', N'09468300913', N'phamthidieulinh@email.com', '123456', N'101 Đường Trần Hưng Đạo, Phường 4, Quận 1, TP. Hồ Chí Minh'),
(N'NV005', N'Huỳnh Văn', N'Đức', '1995-11-20', N'Nam', N'2022-11-27', N'NV', N'0389265491', N'huynhvanduc@email.com', '123456', N'202 Đường Cách Mạng Tháng Tám, Phường 5, Quận Bình Thạnh, TP. Hồ Chí Minh'),
(N'NV006', N'Đặng Thị Mai', N'Anh', '1983-09-18', N'Nữ', N'2024-01-22', N'NV', N'0958360981', N'dangthimaianh@email.com', '123456', N'303 Đường Nguyễn Văn Linh, Phường 6, Quận 7, TP. Hồ Chí Minh'),
(N'NV007', N'Trần Thị Kim', N'Oanh', '1998-04-25', N'Nữ', N'2023-06-09', N'NV', N'0395748650', N'tranthikimoanh@email.com', '123456', N'404 Đường Võ Văn Kiệt, Phường 7, Quận 4, TP. Hồ Chí Minh'),
(N'NV008', N'Mai Thị', N'Phương', '1993-12-30', N'Nữ', N'2022-07-15', N'NV', N'0904358628', N'maithiphuong@email.com', '123456', N'505 Đường Lý Thường Kiệt, Phường 8, Quận 6, TP. Hồ Chí Minh'),
(N'NV009', N'Võ Văn', N'Tuấn', '1989-06-08', N'Nam', N'2023-05-09', N'NV', N'0937471529', N'vovantuan@email.com', '123456', N'606 Đường 3 Tháng 2, Phường 9, Quận 10, TP. Hồ Chí Minh'),
(N'NV010', N'Nguyễn Thị Quỳnh', N'Anh', '1984-02-14', N'Nữ', N'2023-10-12', N'NV', N'09096582531', N'nguyenthiquynhanh@email.com', '123456', N'707 Đường Cộng Hòa, Phường 10, Quận Tân Bình, TP. Hồ Chí Minh')
GO

CREATE TABLE BacThanhVien
(
	MaBacTV NVARCHAR(10) CONSTRAINT PK_BTV_MaBacTV PRIMARY KEY(MaBacTV),
	TenBacTV NVARCHAR(50) NOT NULL,
	ChietKhau FLOAT NOT NULL
)
GO

INSERT INTO BacThanhVien(MaBacTV, TenBacTV, ChietKhau) VALUES
(N'THG', N'Thành viên thường', 0),
(N'BAC', N'Thành viên Bạc', 5),
(N'VANG', N'Thành viên Vàng', 10),
(N'KC', N'Thành viên Kim Cương', 15)
GO

CREATE TABLE KhachHang
(
	MaKH NVARCHAR(10) CONSTRAINT PK_KH_MaKH PRIMARY KEY(MaKH),
	HoKH NVARCHAR(50) NOT NULL,
	TenKH NVARCHAR(50) NOT NULL,
	NgaySinh DATE,
	GioiTinh NVARCHAR(10),
	NgayDangKy DATETIME NOT NULL,
	DiemTichLuy FLOAT,
	MaBacTV NVARCHAR(10) CONSTRAINT FK_KH_MaBacTV FOREIGN KEY(MaBacTV) REFERENCES BacThanhVien(MaBacTV),
	DienThoai NVARCHAR(15) NOT NULL,
	Email NVARCHAR(50),
	DiaChi NVARCHAR(100)
)
GO

CREATE FUNCTION f_AutoMaKH()
RETURNS VARCHAR(10)
AS
BEGIN
    DECLARE @MaKH VARCHAR(10)

    IF NOT EXISTS (SELECT * FROM KhachHang)
		BEGIN
			SET @MaKH = 'KH001'
		END
    ELSE
		BEGIN
			DECLARE @MaxMaKH INT
			SELECT @MaxMaKH = MAX(RIGHT(MaKH, 3)) FROM KhachHang
			SET @MaKH = 'KH' + RIGHT('000' + CAST(@MaxMaKH + 1 AS VARCHAR(3)), 3)
		END

    RETURN @MaKH
END
GO

INSERT INTO KhachHang(MaKH, HoKH, TenKH, NgaySinh, GioiTinh, NgayDangKy, DiemTichLuy, MaBacTV, DienThoai, Email, DiaChi) VALUES 
(N'KH001', N'Hoàng Văn', N'Nam', '1991-03-08', N'Nam', '2023-03-08', 0, N'THG', N'0395726301', N'hoangvannam@email.com', N'808 Đường Hòa Bình, Phường 11, Quận Gò Vấp, TP. Hồ Chí Minh'),
(N'KH002', N'Lê Thị Thùy', N'Trang', '1986-12-10', N'Nữ', '2023-12-24', 0, N'THG', N'0987654321', N'lethithuytrang@email.com', N'909 Đường Tân Bình, Phường 12, Quận Tân Phú, TP. Hồ Chí Minh'),
(N'KH003', N'Nguyễn Văn', N'Long', '1994-07-28', N'Nam', '2023-11-28', 0, N'THG', N'0901234567', N'nguyenvanlong@email.com', N'1010 Đường 3/2, Phường 13, Quận 3, TP. Hồ Chí Minh'),
(N'KH004', N'Trần Thị', N'Mai', '1987-06-17', N'Nữ', '2024-03-19', 0, N'THG', N'0912345678', N'tranthimai@email.com', N'1111 Đường Bình Thạnh, Phường 14, Quận Bình Thạnh, TP. Hồ Chí Minh'),
(N'KH005', N'Phan Văn', N'Hòa', '1997-09-01', N'Nam', '2024-04-08', 0, N'THG', N'0876543210', N'phanvanhoa@email.com', N'1212 Đường Phú Nhuận, Phường 15, Quận Phú Nhuận, TP. Hồ Chí Minh'),
(N'KH006', N'Hồ Thị', N'Thảo', '1982-05-11', N'Nữ', '2024-03-01', 0, N'THG', N'0956789012', N'hothithao@email.com', N'1313 Đường 30/4, Phường 16, Quận 8, TP. Hồ Chí Minh'),
(N'KH007', N'Lý Văn', N'Minh', '1988-06-21', N'Nam', '2023-12-17', 0, N'THG', N'0368273640', N'lyvanminh@email.com', N'1414 Đường 1/5, Phường 17, Quận 9, TP. Hồ Chí Minh'),
(N'KH008', N'Mai Thị', N'Hoài', '1993-03-29', N'Nữ', '2024-03-29', 0, N'THG', N'0926389401', N'maithihoai@email.com', N'1515 Đường 2/9, Phường 18, Quận 10, TP. Hồ Chí Minh'),
(N'KH009', N'Vương Văn', N'Phú', '1984-12-09', N'Nam', '2023-06-13', 0, N'THG', N'0378434329', N'vuongvanphu@email.com', N'1616 Đường 1/7, Phường 19, Quận 11, TP. Hồ Chí Minh'),
(N'KH010', N'Nguyễn Thị', N'Thu', '1990-05-20', N'Nữ', '2023-11-09', 0, N'THG', N'0987298435', N'nguyenthithu@email.com', N'1717 Đường 2/4, Phường 20, Quận 12, TP. Hồ Chí Minh');
GO

CREATE TABLE LoaiSanPham
(
	MaLoaiSP NVARCHAR(10) CONSTRAINT PK_LSP_MaBacTV PRIMARY KEY(MaLoaiSP),
	TenLoaiSP NVARCHAR(50) NOT NULL
)
GO

INSERT INTO LoaiSanPham(MaLoaiSP, TenLoaiSP) VALUES
(N'LSP001', N'Đồ ăn'),
(N'LSP002', N'Thức uống'),
(N'LSP003', N'Combo')
GO

CREATE TABLE SanPham
(
	MaSP NVARCHAR(10) CONSTRAINT PK_SP_MaBacTV PRIMARY KEY(MaSP),
	TenSP NVARCHAR(50) NOT NULL,
	MaLoaiSP NVARCHAR(10) CONSTRAINT FK_SP_MaLoaiSP FOREIGN KEY(MaLoaiSP) REFERENCES LoaiSanPham(MaLoaiSP),
	GiaBan FLOAT NOT NULL,
	SoLuongTon INT NOT NULL,
	HinhAnh VARBINARY(MAX)
)
GO

INSERT INTO SanPham(MaSP, TenSP, MaLoaiSP, GiaBan, SoLuongTon, HinhAnh) VALUES 
(N'SP001', N'Bắp rang bơ caramel', N'LSP001', 50000, 137, NULL),
(N'SP002', N'Bắp rang bơ phô mai', N'LSP001', 50000, 123, NULL),
(N'SP003', N'Hot dog', N'LSP001', 35000, 20, NULL),
(N'SP004', N'Sandwich', N'LSP001', 45000, 20, NULL),
(N'SP005', N'Pepsi', N'LSP002', 20000, 234, NULL),
(N'SP006', N'Nước suối', N'LSP002', 15000, 140, NULL)
GO

CREATE FUNCTION f_AutoMaSP()
RETURNS VARCHAR(10)
AS
BEGIN
    DECLARE @MaSP VARCHAR(10)

    IF NOT EXISTS (SELECT * FROM SanPham)
		BEGIN
			SET @MaSP = 'SP001'
		END
    ELSE
		BEGIN
			DECLARE @MaxMaSP INT
			SELECT @MaxMaSP = MAX(RIGHT(MaSP, 3)) FROM SanPham
			SET @MaSP = 'SP' + RIGHT('000' + CAST(@MaxMaSP + 1 AS VARCHAR(3)), 3)
		END

    RETURN @MaSP
END
GO

CREATE TRIGGER SetProductImageToNullOnEmpty
ON SanPham
AFTER INSERT, UPDATE
AS
BEGIN
    SET NOCOUNT ON;

    UPDATE SanPham
    SET HinhAnh = NULL
    FROM SanPham
    INNER JOIN inserted ON SanPham.MaSP = inserted.MaSP
    WHERE inserted.HinhAnh IS NOT NULL AND DATALENGTH(inserted.HinhAnh) = 0;
END
GO

CREATE TABLE HoaDon
(
	MaHD NVARCHAR(10) CONSTRAINT PK_HD_MaHD PRIMARY KEY(MaHD),
	MaKH NVARCHAR(10) CONSTRAINT FK_HD_MaKH FOREIGN KEY(MaKH) REFERENCES KhachHang(MaKH),
	MaNV NVARCHAR(10) CONSTRAINT FK_HD_MaNV FOREIGN KEY(MaNV) REFERENCES NhanVien(MaNV),
	NgayTao DATETIME NOT NULL,
	ChietKhau INT
)
GO

CREATE TABLE Ve
(
	MaVe NVARCHAR(10) CONSTRAINT PK_V_MaVe PRIMARY KEY(MaVe),
	MaHD NVARCHAR(10) CONSTRAINT FK_V_MaHD FOREIGN KEY(MaHD) REFERENCES HoaDon(MaHD),
	MaGhe NVARCHAR(10) CONSTRAINT FK_V_MaGhe FOREIGN KEY(MaGhe) REFERENCES Ghe(MaGhe),
	MaSC NVARCHAR(10) CONSTRAINT FK_V_MaSC FOREIGN KEY(MaSC) REFERENCES SuatCHieu(MaSC)
)
GO

CREATE TABLE HoaDonBapNuoc
(
	MaHDBN NVARCHAR(10) CONSTRAINT PK_HDBN_MaHDBN PRIMARY KEY(MaHDBN),
	MaHD NVARCHAR(10) CONSTRAINT FK_HDBN_MaHD FOREIGN KEY(MaHD) REFERENCES HoaDon(MaHD),
	MaSP NVARCHAR(10) CONSTRAINT FK_HDBN_MaSP FOREIGN KEY(MaSP) REFERENCES SanPham(MaSP),
	SoLuong INT NOT NULL
)
GO

CREATE TRIGGER UpdateTinhTrangAfterInsert
ON Ve
AFTER INSERT
AS
BEGIN
    UPDATE ChiTietSuatChieu
    SET TinhTrang = N'Đã đặt'
    WHERE EXISTS (
        SELECT 1
        FROM inserted
        WHERE ChiTietSuatChieu.MaSC = inserted.MaSC
          AND ChiTietSuatChieu.MaGhe = inserted.MaGhe
    );
END;
GO

CREATE FUNCTION f_AutoMaHD()
RETURNS VARCHAR(10)
AS
BEGIN
    DECLARE @MaHD VARCHAR(10)

    IF NOT EXISTS (SELECT * FROM HoaDon)
		BEGIN
			SET @MaHD = 'HD000001'
		END
    ELSE
		BEGIN
			DECLARE @MaxMaHD INT
			SELECT @MaxMaHD = MAX(RIGHT(MaHD, 6)) FROM HoaDon
			SET @MaHD = 'HD' + RIGHT('000000' + CAST(@MaxMaHD + 1 AS VARCHAR(6)), 6)
		END

    RETURN @MaHD
END
GO

CREATE FUNCTION f_AutoMaVe()
RETURNS VARCHAR(10)
AS
BEGIN
    DECLARE @MaVe VARCHAR(10)

    IF NOT EXISTS (SELECT * FROM Ve)
		BEGIN
			SET @MaVe = 'V000001'
		END
    ELSE
		BEGIN
			DECLARE @MaxMaVe INT
			SELECT @MaxMaVe = MAX(RIGHT(MaVe, 6)) FROM Ve
			SET @MaVe = 'V' + RIGHT('000000' + CAST(@MaxMaVe + 1 AS VARCHAR(6)), 6)
		END

    RETURN @MaVe
END
GO

CREATE FUNCTION f_AutoMaHDBN()
RETURNS VARCHAR(10)
AS
BEGIN
    DECLARE @MaHDBN VARCHAR(10)

    IF NOT EXISTS (SELECT * FROM HoaDonBapNuoc)
		BEGIN
			SET @MaHDBN = 'BN000001'
		END
    ELSE
		BEGIN
			DECLARE @MaxMaHDBN INT
			SELECT @MaxMaHDBN = MAX(RIGHT(MaHDBN, 6)) FROM HoaDonBapNuoc
			SET @MaHDBN = 'BN' + RIGHT('000000' + CAST(@MaxMaHDBN + 1 AS VARCHAR(6)), 6)
		END

    RETURN @MaHDBN
END
GO

CREATE TRIGGER tg_UpdateSoLuongTon
ON HoaDonBapNuoc
AFTER INSERT
AS
BEGIN
    DECLARE @MaSP NVARCHAR(10);
    DECLARE @SoLuong INT;
    
    SELECT @MaSP = inserted.MaSP, @SoLuong = inserted.SoLuong
    FROM inserted;
    
    UPDATE SanPham
    SET SoLuongTon = SoLuongTon - @SoLuong
    WHERE MaSP = @MaSP;
END;

CREATE PROCEDURE sp_HoaDon_Ve @MaHD NVARCHAR(50)
AS
BEGIN
    SELECT hd.MaHD, NgayTao, ISNULL(HoNV, '') + ' ' + ISNULL(TenNV, '') AS HoTenNV, 
		ISNULL(HoKH, '') + ' ' + ISNULL(TenKH, '') AS HoTenKH, TenPhim, ThoiGian, TenPhong, 
        (SELECT STRING_AGG(MaGhe, ', ') FROM Ve v JOIN SuatChieu sc ON v.MaSC = sc.MaSC WHERE MaHD = hd.MaHD) AS GheDaDat
    FROM HoaDon hd 
    JOIN Ve v ON hd.MaHD = v.MaHD
    JOIN SuatChieu sc ON v.MaSC = sc.MaSC
    JOIN Phim p ON sc.MaPhim = p.MaPhim
    JOIN PhongChieu pc ON sc.MaPhong = pc.MaPhong
    JOIN NhanVien nv ON hd.MaNV = nv.MaNV
    JOIN KhachHang kh ON hd.MaKH = kh.MaKH
    WHERE hd.MaHD = @MaHD
    GROUP BY hd.MaHD, NgayTao, HoNV, TenNV, HoKH, TenKH, TenPhim, ThoiGian, TenPhong
END

EXEC dbo.sp_HoaDon_Ve 'HD000001'
--------- start -----------



SELECT * FROM HoaDon
SELECT * FROM Ve
SELECT * FROM HoaDonBapNuoc

SELECT * FROM SanPham


SELECT hd.MaHD, NgayTao, ISNULL(HoNV, '') + ' ' + ISNULL(TenNV, '') AS HoTenNV, HoKH + ' ' + TenKH AS HoTenKH, TenPhim, ThoiGian, TenPhong, 
MaGhe
FROM HoaDon hd JOIN Ve v ON hd.MaHD = v.MaHD
JOIN SuatChieu sc ON v.MaSC = sc.MaSC
JOIN Phim p ON sc.MaPhim = p.MaPhim
JOIN PhongChieu pc ON sc.MaPhong = pc.MaPhong
JOIN NhanVien nv ON hd.MaNV = nv.MaNV
JOIN KhachHang kh ON hd.MaKH = kh.MaKH
WHERE hd.MaHD = 'HD000001'


SELECT hd.MaHD, NgayTao, ISNULL(HoNV, '') + ' ' + ISNULL(TenNV, '') AS HoTenNV, HoKH + ' ' + TenKH AS HoTenKH, TenPhim, ThoiGian, TenPhong, 
(SELECT STRING_AGG(MaGhe, ', ') FROM Ve v JOIN SuatChieu sc ON v.MaSC = sc.MaSC WHERE MaHD = 'HD000001') AS GheDaDat
FROM HoaDon hd JOIN Ve v ON hd.MaHD = v.MaHD
JOIN SuatChieu sc ON v.MaSC = sc.MaSC
JOIN Phim p ON sc.MaPhim = p.MaPhim
JOIN PhongChieu pc ON sc.MaPhong = pc.MaPhong
JOIN NhanVien nv ON hd.MaNV = nv.MaNV
JOIN KhachHang kh ON hd.MaKH = kh.MaKH
WHERE hd.MaHD = 'HD000001'


SELECT *
FROM HoaDon hd JOIN HoaDonBapNuoc hdbn ON hd.MaHD = hdbn.MaHD

SELECT p.MaPhim, p.TenPhim, p.MaPL,	pl.BieuTuongPL, p.DaoDien, p.QuocGia, p.ThoiLuong, p.NgayKhoiChieu, p.MoTa, p.Poster, p.Trailer,
(SELECT STRING_AGG(tl.TenTheLoai, ', ')
FROM TheLoai_Phim AS tlp INNER JOIN TheLoai AS tl ON tlp.MaTL = tl.MaTL
WHERE tlp.MaPhim = p.MaPhim) AS 'TheLoaiPhim'
FROM Phim AS p LEFT JOIN PhanLoai AS pl ON p.MaPL = pl.MaPL
--------- end -----------

--CREATE TABLE ChiTietHoaDon
--(
--	MaHD NVARCHAR(10) CONSTRAINT FK_CTHD_MaKH FOREIGN KEY(MaHD) REFERENCES HoaDon(MaHD),
--	MaSP NVARCHAR(10) CONSTRAINT FK_CTHD_MaSP FOREIGN KEY(MaSP) REFERENCES SanPham(MaSP),
--	CONSTRAINT PK_CTHD_MaHD PRIMARY KEY(MaHD, MaSP),
--	SoLuong INT NOT NULL
--)

--CREATE TABLE LoaiVe
--(
--	MaLV NVARCHAR(10) CONSTRAINT PK_LV_MaLV PRIMARY KEY(MaLV),
--	TenLV NVARCHAR(100) NOT NULL, -- VIP, thường, khuyến mãi
--	Gia INT NOT NULL
--)
--GO

--CREATE TABLE Ve
--(
--	MaVe NVARCHAR(10) CONSTRAINT PK_Ve_MaVe PRIMARY KEY(MaVe),
--	MaLV NVARCHAR(10) CONSTRAINT FK_Ve_MaLV FOREIGN KEY(MaLV) REFERENCES LoaiVe(MaLV),
--	MaNV NVARCHAR(10) CONSTRAINT FK_Ve_MaNV FOREIGN KEY(MaNV) REFERENCES NhanVien(MaNV),
--	MaKH NVARCHAR(10) CONSTRAINT FK_Ve_MaKH FOREIGN KEY(MaKH) REFERENCES KhachHang(MaKH),
--	Ghe NVARCHAR(10) NOT NULL,
--	NgayBanVe DATE
--)
--GO

--CREATE TABLE ThongTinVe
--(
--	MaVe NVARCHAR(10) CONSTRAINT FK_TTV_MaVe FOREIGN KEY(MaVe) REFERENCES Ve(MaVe),
--	MaPhong NVARCHAR(10) CONSTRAINT FK_TTV_MaPhong FOREIGN KEY(MaPhong) REFERENCES PhongChieu(MaPhong),
--	MaPhim NVARCHAR(10) CONSTRAINT FK_TTV_MaPhim FOREIGN KEY(MaVe) REFERENCES Phim(MaPhim),
--	XuatChieu DATETIME NOT NULL,
--	CONSTRAINT PK_TTV_MaVe_MaPhong_MaPhim PRIMARY KEY(MaVe, MaPhong, MaPhim),
--)
--GO
